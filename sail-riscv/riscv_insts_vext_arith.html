<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style>.sail-id { color: black; }
.sail-keyword { font-weight: bold; color: maroon; }
.sail-kind { color: purple; }
.sail-comment { color: green; }
.sail-string { color: red; }
.sail-pragma { font-weight: bold; color: blue; }
.sail-internal { font-weight: bold; color: red; }
.sail-operator { color: maroon; }
.sail-literal { color: teal; }
.sail-ty-var { color: blue; }
#sail-html-columns { display: flex; width: 100%; }
#sail-html-lines { padding-left: 10px; padding-right: 10px; width: min-content; text-align: right; white-space: nowrap; }
#sail-html-source { padding-left: 10px; flex: 1; }
:target { background: yellow; }
</style>
</head>
<body>
<pre>
<div id="sail-html-columns">
<div id="sail-html-lines"><span id="L1">1</span><br /><span id="L2">2</span><br /><span id="L3">3</span><br /><span id="L4">4</span><br /><span id="L5">5</span><br /><span id="L6">6</span><br /><span id="L7">7</span><br /><span id="L8">8</span><br /><span id="L9">9</span><br /><span id="L10">10</span><br /><span id="L11">11</span><br /><span id="L12">12</span><br /><span id="L13">13</span><br /><span id="L14">14</span><br /><span id="L15">15</span><br /><span id="L16">16</span><br /><span id="L17">17</span><br /><span id="L18">18</span><br /><span id="L19">19</span><br /><span id="L20">20</span><br /><span id="L21">21</span><br /><span id="L22">22</span><br /><span id="L23">23</span><br /><span id="L24">24</span><br /><span id="L25">25</span><br /><span id="L26">26</span><br /><span id="L27">27</span><br /><span id="L28">28</span><br /><span id="L29">29</span><br /><span id="L30">30</span><br /><span id="L31">31</span><br /><span id="L32">32</span><br /><span id="L33">33</span><br /><span id="L34">34</span><br /><span id="L35">35</span><br /><span id="L36">36</span><br /><span id="L37">37</span><br /><span id="L38">38</span><br /><span id="L39">39</span><br /><span id="L40">40</span><br /><span id="L41">41</span><br /><span id="L42">42</span><br /><span id="L43">43</span><br /><span id="L44">44</span><br /><span id="L45">45</span><br /><span id="L46">46</span><br /><span id="L47">47</span><br /><span id="L48">48</span><br /><span id="L49">49</span><br /><span id="L50">50</span><br /><span id="L51">51</span><br /><span id="L52">52</span><br /><span id="L53">53</span><br /><span id="L54">54</span><br /><span id="L55">55</span><br /><span id="L56">56</span><br /><span id="L57">57</span><br /><span id="L58">58</span><br /><span id="L59">59</span><br /><span id="L60">60</span><br /><span id="L61">61</span><br /><span id="L62">62</span><br /><span id="L63">63</span><br /><span id="L64">64</span><br /><span id="L65">65</span><br /><span id="L66">66</span><br /><span id="L67">67</span><br /><span id="L68">68</span><br /><span id="L69">69</span><br /><span id="L70">70</span><br /><span id="L71">71</span><br /><span id="L72">72</span><br /><span id="L73">73</span><br /><span id="L74">74</span><br /><span id="L75">75</span><br /><span id="L76">76</span><br /><span id="L77">77</span><br /><span id="L78">78</span><br /><span id="L79">79</span><br /><span id="L80">80</span><br /><span id="L81">81</span><br /><span id="L82">82</span><br /><span id="L83">83</span><br /><span id="L84">84</span><br /><span id="L85">85</span><br /><span id="L86">86</span><br /><span id="L87">87</span><br /><span id="L88">88</span><br /><span id="L89">89</span><br /><span id="L90">90</span><br /><span id="L91">91</span><br /><span id="L92">92</span><br /><span id="L93">93</span><br /><span id="L94">94</span><br /><span id="L95">95</span><br /><span id="L96">96</span><br /><span id="L97">97</span><br /><span id="L98">98</span><br /><span id="L99">99</span><br /><span id="L100">100</span><br /><span id="L101">101</span><br /><span id="L102">102</span><br /><span id="L103">103</span><br /><span id="L104">104</span><br /><span id="L105">105</span><br /><span id="L106">106</span><br /><span id="L107">107</span><br /><span id="L108">108</span><br /><span id="L109">109</span><br /><span id="L110">110</span><br /><span id="L111">111</span><br /><span id="L112">112</span><br /><span id="L113">113</span><br /><span id="L114">114</span><br /><span id="L115">115</span><br /><span id="L116">116</span><br /><span id="L117">117</span><br /><span id="L118">118</span><br /><span id="L119">119</span><br /><span id="L120">120</span><br /><span id="L121">121</span><br /><span id="L122">122</span><br /><span id="L123">123</span><br /><span id="L124">124</span><br /><span id="L125">125</span><br /><span id="L126">126</span><br /><span id="L127">127</span><br /><span id="L128">128</span><br /><span id="L129">129</span><br /><span id="L130">130</span><br /><span id="L131">131</span><br /><span id="L132">132</span><br /><span id="L133">133</span><br /><span id="L134">134</span><br /><span id="L135">135</span><br /><span id="L136">136</span><br /><span id="L137">137</span><br /><span id="L138">138</span><br /><span id="L139">139</span><br /><span id="L140">140</span><br /><span id="L141">141</span><br /><span id="L142">142</span><br /><span id="L143">143</span><br /><span id="L144">144</span><br /><span id="L145">145</span><br /><span id="L146">146</span><br /><span id="L147">147</span><br /><span id="L148">148</span><br /><span id="L149">149</span><br /><span id="L150">150</span><br /><span id="L151">151</span><br /><span id="L152">152</span><br /><span id="L153">153</span><br /><span id="L154">154</span><br /><span id="L155">155</span><br /><span id="L156">156</span><br /><span id="L157">157</span><br /><span id="L158">158</span><br /><span id="L159">159</span><br /><span id="L160">160</span><br /><span id="L161">161</span><br /><span id="L162">162</span><br /><span id="L163">163</span><br /><span id="L164">164</span><br /><span id="L165">165</span><br /><span id="L166">166</span><br /><span id="L167">167</span><br /><span id="L168">168</span><br /><span id="L169">169</span><br /><span id="L170">170</span><br /><span id="L171">171</span><br /><span id="L172">172</span><br /><span id="L173">173</span><br /><span id="L174">174</span><br /><span id="L175">175</span><br /><span id="L176">176</span><br /><span id="L177">177</span><br /><span id="L178">178</span><br /><span id="L179">179</span><br /><span id="L180">180</span><br /><span id="L181">181</span><br /><span id="L182">182</span><br /><span id="L183">183</span><br /><span id="L184">184</span><br /><span id="L185">185</span><br /><span id="L186">186</span><br /><span id="L187">187</span><br /><span id="L188">188</span><br /><span id="L189">189</span><br /><span id="L190">190</span><br /><span id="L191">191</span><br /><span id="L192">192</span><br /><span id="L193">193</span><br /><span id="L194">194</span><br /><span id="L195">195</span><br /><span id="L196">196</span><br /><span id="L197">197</span><br /><span id="L198">198</span><br /><span id="L199">199</span><br /><span id="L200">200</span><br /><span id="L201">201</span><br /><span id="L202">202</span><br /><span id="L203">203</span><br /><span id="L204">204</span><br /><span id="L205">205</span><br /><span id="L206">206</span><br /><span id="L207">207</span><br /><span id="L208">208</span><br /><span id="L209">209</span><br /><span id="L210">210</span><br /><span id="L211">211</span><br /><span id="L212">212</span><br /><span id="L213">213</span><br /><span id="L214">214</span><br /><span id="L215">215</span><br /><span id="L216">216</span><br /><span id="L217">217</span><br /><span id="L218">218</span><br /><span id="L219">219</span><br /><span id="L220">220</span><br /><span id="L221">221</span><br /><span id="L222">222</span><br /><span id="L223">223</span><br /><span id="L224">224</span><br /><span id="L225">225</span><br /><span id="L226">226</span><br /><span id="L227">227</span><br /><span id="L228">228</span><br /><span id="L229">229</span><br /><span id="L230">230</span><br /><span id="L231">231</span><br /><span id="L232">232</span><br /><span id="L233">233</span><br /><span id="L234">234</span><br /><span id="L235">235</span><br /><span id="L236">236</span><br /><span id="L237">237</span><br /><span id="L238">238</span><br /><span id="L239">239</span><br /><span id="L240">240</span><br /><span id="L241">241</span><br /><span id="L242">242</span><br /><span id="L243">243</span><br /><span id="L244">244</span><br /><span id="L245">245</span><br /><span id="L246">246</span><br /><span id="L247">247</span><br /><span id="L248">248</span><br /><span id="L249">249</span><br /><span id="L250">250</span><br /><span id="L251">251</span><br /><span id="L252">252</span><br /><span id="L253">253</span><br /><span id="L254">254</span><br /><span id="L255">255</span><br /><span id="L256">256</span><br /><span id="L257">257</span><br /><span id="L258">258</span><br /><span id="L259">259</span><br /><span id="L260">260</span><br /><span id="L261">261</span><br /><span id="L262">262</span><br /><span id="L263">263</span><br /><span id="L264">264</span><br /><span id="L265">265</span><br /><span id="L266">266</span><br /><span id="L267">267</span><br /><span id="L268">268</span><br /><span id="L269">269</span><br /><span id="L270">270</span><br /><span id="L271">271</span><br /><span id="L272">272</span><br /><span id="L273">273</span><br /><span id="L274">274</span><br /><span id="L275">275</span><br /><span id="L276">276</span><br /><span id="L277">277</span><br /><span id="L278">278</span><br /><span id="L279">279</span><br /><span id="L280">280</span><br /><span id="L281">281</span><br /><span id="L282">282</span><br /><span id="L283">283</span><br /><span id="L284">284</span><br /><span id="L285">285</span><br /><span id="L286">286</span><br /><span id="L287">287</span><br /><span id="L288">288</span><br /><span id="L289">289</span><br /><span id="L290">290</span><br /><span id="L291">291</span><br /><span id="L292">292</span><br /><span id="L293">293</span><br /><span id="L294">294</span><br /><span id="L295">295</span><br /><span id="L296">296</span><br /><span id="L297">297</span><br /><span id="L298">298</span><br /><span id="L299">299</span><br /><span id="L300">300</span><br /><span id="L301">301</span><br /><span id="L302">302</span><br /><span id="L303">303</span><br /><span id="L304">304</span><br /><span id="L305">305</span><br /><span id="L306">306</span><br /><span id="L307">307</span><br /><span id="L308">308</span><br /><span id="L309">309</span><br /><span id="L310">310</span><br /><span id="L311">311</span><br /><span id="L312">312</span><br /><span id="L313">313</span><br /><span id="L314">314</span><br /><span id="L315">315</span><br /><span id="L316">316</span><br /><span id="L317">317</span><br /><span id="L318">318</span><br /><span id="L319">319</span><br /><span id="L320">320</span><br /><span id="L321">321</span><br /><span id="L322">322</span><br /><span id="L323">323</span><br /><span id="L324">324</span><br /><span id="L325">325</span><br /><span id="L326">326</span><br /><span id="L327">327</span><br /><span id="L328">328</span><br /><span id="L329">329</span><br /><span id="L330">330</span><br /><span id="L331">331</span><br /><span id="L332">332</span><br /><span id="L333">333</span><br /><span id="L334">334</span><br /><span id="L335">335</span><br /><span id="L336">336</span><br /><span id="L337">337</span><br /><span id="L338">338</span><br /><span id="L339">339</span><br /><span id="L340">340</span><br /><span id="L341">341</span><br /><span id="L342">342</span><br /><span id="L343">343</span><br /><span id="L344">344</span><br /><span id="L345">345</span><br /><span id="L346">346</span><br /><span id="L347">347</span><br /><span id="L348">348</span><br /><span id="L349">349</span><br /><span id="L350">350</span><br /><span id="L351">351</span><br /><span id="L352">352</span><br /><span id="L353">353</span><br /><span id="L354">354</span><br /><span id="L355">355</span><br /><span id="L356">356</span><br /><span id="L357">357</span><br /><span id="L358">358</span><br /><span id="L359">359</span><br /><span id="L360">360</span><br /><span id="L361">361</span><br /><span id="L362">362</span><br /><span id="L363">363</span><br /><span id="L364">364</span><br /><span id="L365">365</span><br /><span id="L366">366</span><br /><span id="L367">367</span><br /><span id="L368">368</span><br /><span id="L369">369</span><br /><span id="L370">370</span><br /><span id="L371">371</span><br /><span id="L372">372</span><br /><span id="L373">373</span><br /><span id="L374">374</span><br /><span id="L375">375</span><br /><span id="L376">376</span><br /><span id="L377">377</span><br /><span id="L378">378</span><br /><span id="L379">379</span><br /><span id="L380">380</span><br /><span id="L381">381</span><br /><span id="L382">382</span><br /><span id="L383">383</span><br /><span id="L384">384</span><br /><span id="L385">385</span><br /><span id="L386">386</span><br /><span id="L387">387</span><br /><span id="L388">388</span><br /><span id="L389">389</span><br /><span id="L390">390</span><br /><span id="L391">391</span><br /><span id="L392">392</span><br /><span id="L393">393</span><br /><span id="L394">394</span><br /><span id="L395">395</span><br /><span id="L396">396</span><br /><span id="L397">397</span><br /><span id="L398">398</span><br /><span id="L399">399</span><br /><span id="L400">400</span><br /><span id="L401">401</span><br /><span id="L402">402</span><br /><span id="L403">403</span><br /><span id="L404">404</span><br /><span id="L405">405</span><br /><span id="L406">406</span><br /><span id="L407">407</span><br /><span id="L408">408</span><br /><span id="L409">409</span><br /><span id="L410">410</span><br /><span id="L411">411</span><br /><span id="L412">412</span><br /><span id="L413">413</span><br /><span id="L414">414</span><br /><span id="L415">415</span><br /><span id="L416">416</span><br /><span id="L417">417</span><br /><span id="L418">418</span><br /><span id="L419">419</span><br /><span id="L420">420</span><br /><span id="L421">421</span><br /><span id="L422">422</span><br /><span id="L423">423</span><br /><span id="L424">424</span><br /><span id="L425">425</span><br /><span id="L426">426</span><br /><span id="L427">427</span><br /><span id="L428">428</span><br /><span id="L429">429</span><br /><span id="L430">430</span><br /><span id="L431">431</span><br /><span id="L432">432</span><br /><span id="L433">433</span><br /><span id="L434">434</span><br /><span id="L435">435</span><br /><span id="L436">436</span><br /><span id="L437">437</span><br /><span id="L438">438</span><br /><span id="L439">439</span><br /><span id="L440">440</span><br /><span id="L441">441</span><br /><span id="L442">442</span><br /><span id="L443">443</span><br /><span id="L444">444</span><br /><span id="L445">445</span><br /><span id="L446">446</span><br /><span id="L447">447</span><br /><span id="L448">448</span><br /><span id="L449">449</span><br /><span id="L450">450</span><br /><span id="L451">451</span><br /><span id="L452">452</span><br /><span id="L453">453</span><br /><span id="L454">454</span><br /><span id="L455">455</span><br /><span id="L456">456</span><br /><span id="L457">457</span><br /><span id="L458">458</span><br /><span id="L459">459</span><br /><span id="L460">460</span><br /><span id="L461">461</span><br /><span id="L462">462</span><br /><span id="L463">463</span><br /><span id="L464">464</span><br /><span id="L465">465</span><br /><span id="L466">466</span><br /><span id="L467">467</span><br /><span id="L468">468</span><br /><span id="L469">469</span><br /><span id="L470">470</span><br /><span id="L471">471</span><br /><span id="L472">472</span><br /><span id="L473">473</span><br /><span id="L474">474</span><br /><span id="L475">475</span><br /><span id="L476">476</span><br /><span id="L477">477</span><br /><span id="L478">478</span><br /><span id="L479">479</span><br /><span id="L480">480</span><br /><span id="L481">481</span><br /><span id="L482">482</span><br /><span id="L483">483</span><br /><span id="L484">484</span><br /><span id="L485">485</span><br /><span id="L486">486</span><br /><span id="L487">487</span><br /><span id="L488">488</span><br /><span id="L489">489</span><br /><span id="L490">490</span><br /><span id="L491">491</span><br /><span id="L492">492</span><br /><span id="L493">493</span><br /><span id="L494">494</span><br /><span id="L495">495</span><br /><span id="L496">496</span><br /><span id="L497">497</span><br /><span id="L498">498</span><br /><span id="L499">499</span><br /><span id="L500">500</span><br /><span id="L501">501</span><br /><span id="L502">502</span><br /><span id="L503">503</span><br /><span id="L504">504</span><br /><span id="L505">505</span><br /><span id="L506">506</span><br /><span id="L507">507</span><br /><span id="L508">508</span><br /><span id="L509">509</span><br /><span id="L510">510</span><br /><span id="L511">511</span><br /><span id="L512">512</span><br /><span id="L513">513</span><br /><span id="L514">514</span><br /><span id="L515">515</span><br /><span id="L516">516</span><br /><span id="L517">517</span><br /><span id="L518">518</span><br /><span id="L519">519</span><br /><span id="L520">520</span><br /><span id="L521">521</span><br /><span id="L522">522</span><br /><span id="L523">523</span><br /><span id="L524">524</span><br /><span id="L525">525</span><br /><span id="L526">526</span><br /><span id="L527">527</span><br /><span id="L528">528</span><br /><span id="L529">529</span><br /><span id="L530">530</span><br /><span id="L531">531</span><br /><span id="L532">532</span><br /><span id="L533">533</span><br /><span id="L534">534</span><br /><span id="L535">535</span><br /><span id="L536">536</span><br /><span id="L537">537</span><br /><span id="L538">538</span><br /><span id="L539">539</span><br /><span id="L540">540</span><br /><span id="L541">541</span><br /><span id="L542">542</span><br /><span id="L543">543</span><br /><span id="L544">544</span><br /><span id="L545">545</span><br /><span id="L546">546</span><br /><span id="L547">547</span><br /><span id="L548">548</span><br /><span id="L549">549</span><br /><span id="L550">550</span><br /><span id="L551">551</span><br /><span id="L552">552</span><br /><span id="L553">553</span><br /><span id="L554">554</span><br /><span id="L555">555</span><br /><span id="L556">556</span><br /><span id="L557">557</span><br /><span id="L558">558</span><br /><span id="L559">559</span><br /><span id="L560">560</span><br /><span id="L561">561</span><br /><span id="L562">562</span><br /><span id="L563">563</span><br /><span id="L564">564</span><br /><span id="L565">565</span><br /><span id="L566">566</span><br /><span id="L567">567</span><br /><span id="L568">568</span><br /><span id="L569">569</span><br /><span id="L570">570</span><br /><span id="L571">571</span><br /><span id="L572">572</span><br /><span id="L573">573</span><br /><span id="L574">574</span><br /><span id="L575">575</span><br /><span id="L576">576</span><br /><span id="L577">577</span><br /><span id="L578">578</span><br /><span id="L579">579</span><br /><span id="L580">580</span><br /><span id="L581">581</span><br /><span id="L582">582</span><br /><span id="L583">583</span><br /><span id="L584">584</span><br /><span id="L585">585</span><br /><span id="L586">586</span><br /><span id="L587">587</span><br /><span id="L588">588</span><br /><span id="L589">589</span><br /><span id="L590">590</span><br /><span id="L591">591</span><br /><span id="L592">592</span><br /><span id="L593">593</span><br /><span id="L594">594</span><br /><span id="L595">595</span><br /><span id="L596">596</span><br /><span id="L597">597</span><br /><span id="L598">598</span><br /><span id="L599">599</span><br /><span id="L600">600</span><br /><span id="L601">601</span><br /><span id="L602">602</span><br /><span id="L603">603</span><br /><span id="L604">604</span><br /><span id="L605">605</span><br /><span id="L606">606</span><br /><span id="L607">607</span><br /><span id="L608">608</span><br /><span id="L609">609</span><br /><span id="L610">610</span><br /><span id="L611">611</span><br /><span id="L612">612</span><br /><span id="L613">613</span><br /><span id="L614">614</span><br /><span id="L615">615</span><br /><span id="L616">616</span><br /><span id="L617">617</span><br /><span id="L618">618</span><br /><span id="L619">619</span><br /><span id="L620">620</span><br /><span id="L621">621</span><br /><span id="L622">622</span><br /><span id="L623">623</span><br /><span id="L624">624</span><br /><span id="L625">625</span><br /><span id="L626">626</span><br /><span id="L627">627</span><br /><span id="L628">628</span><br /><span id="L629">629</span><br /><span id="L630">630</span><br /><span id="L631">631</span><br /><span id="L632">632</span><br /><span id="L633">633</span><br /><span id="L634">634</span><br /><span id="L635">635</span><br /><span id="L636">636</span><br /><span id="L637">637</span><br /><span id="L638">638</span><br /><span id="L639">639</span><br /><span id="L640">640</span><br /><span id="L641">641</span><br /><span id="L642">642</span><br /><span id="L643">643</span><br /><span id="L644">644</span><br /><span id="L645">645</span><br /><span id="L646">646</span><br /><span id="L647">647</span><br /><span id="L648">648</span><br /><span id="L649">649</span><br /><span id="L650">650</span><br /><span id="L651">651</span><br /><span id="L652">652</span><br /><span id="L653">653</span><br /><span id="L654">654</span><br /><span id="L655">655</span><br /><span id="L656">656</span><br /><span id="L657">657</span><br /><span id="L658">658</span><br /><span id="L659">659</span><br /><span id="L660">660</span><br /><span id="L661">661</span><br /><span id="L662">662</span><br /><span id="L663">663</span><br /><span id="L664">664</span><br /><span id="L665">665</span><br /><span id="L666">666</span><br /><span id="L667">667</span><br /><span id="L668">668</span><br /><span id="L669">669</span><br /><span id="L670">670</span><br /><span id="L671">671</span><br /><span id="L672">672</span><br /><span id="L673">673</span><br /><span id="L674">674</span><br /><span id="L675">675</span><br /><span id="L676">676</span><br /><span id="L677">677</span><br /><span id="L678">678</span><br /><span id="L679">679</span><br /><span id="L680">680</span><br /><span id="L681">681</span><br /><span id="L682">682</span><br /><span id="L683">683</span><br /><span id="L684">684</span><br /><span id="L685">685</span><br /><span id="L686">686</span><br /><span id="L687">687</span><br /><span id="L688">688</span><br /><span id="L689">689</span><br /><span id="L690">690</span><br /><span id="L691">691</span><br /><span id="L692">692</span><br /><span id="L693">693</span><br /><span id="L694">694</span><br /><span id="L695">695</span><br /><span id="L696">696</span><br /><span id="L697">697</span><br /><span id="L698">698</span><br /><span id="L699">699</span><br /><span id="L700">700</span><br /><span id="L701">701</span><br /><span id="L702">702</span><br /><span id="L703">703</span><br /><span id="L704">704</span><br /><span id="L705">705</span><br /><span id="L706">706</span><br /><span id="L707">707</span><br /><span id="L708">708</span><br /><span id="L709">709</span><br /><span id="L710">710</span><br /><span id="L711">711</span><br /><span id="L712">712</span><br /><span id="L713">713</span><br /><span id="L714">714</span><br /><span id="L715">715</span><br /><span id="L716">716</span><br /><span id="L717">717</span><br /><span id="L718">718</span><br /><span id="L719">719</span><br /><span id="L720">720</span><br /><span id="L721">721</span><br /><span id="L722">722</span><br /><span id="L723">723</span><br /><span id="L724">724</span><br /><span id="L725">725</span><br /><span id="L726">726</span><br /><span id="L727">727</span><br /><span id="L728">728</span><br /><span id="L729">729</span><br /><span id="L730">730</span><br /><span id="L731">731</span><br /><span id="L732">732</span><br /><span id="L733">733</span><br /><span id="L734">734</span><br /><span id="L735">735</span><br /><span id="L736">736</span><br /><span id="L737">737</span><br /><span id="L738">738</span><br /><span id="L739">739</span><br /><span id="L740">740</span><br /><span id="L741">741</span><br /><span id="L742">742</span><br /><span id="L743">743</span><br /><span id="L744">744</span><br /><span id="L745">745</span><br /><span id="L746">746</span><br /><span id="L747">747</span><br /><span id="L748">748</span><br /><span id="L749">749</span><br /><span id="L750">750</span><br /><span id="L751">751</span><br /><span id="L752">752</span><br /><span id="L753">753</span><br /><span id="L754">754</span><br /><span id="L755">755</span><br /><span id="L756">756</span><br /><span id="L757">757</span><br /><span id="L758">758</span><br /><span id="L759">759</span><br /><span id="L760">760</span><br /><span id="L761">761</span><br /><span id="L762">762</span><br /><span id="L763">763</span><br /><span id="L764">764</span><br /><span id="L765">765</span><br /><span id="L766">766</span><br /><span id="L767">767</span><br /><span id="L768">768</span><br /><span id="L769">769</span><br /><span id="L770">770</span><br /><span id="L771">771</span><br /><span id="L772">772</span><br /><span id="L773">773</span><br /><span id="L774">774</span><br /><span id="L775">775</span><br /><span id="L776">776</span><br /><span id="L777">777</span><br /><span id="L778">778</span><br /><span id="L779">779</span><br /><span id="L780">780</span><br /><span id="L781">781</span><br /><span id="L782">782</span><br /><span id="L783">783</span><br /><span id="L784">784</span><br /><span id="L785">785</span><br /><span id="L786">786</span><br /><span id="L787">787</span><br /><span id="L788">788</span><br /><span id="L789">789</span><br /><span id="L790">790</span><br /><span id="L791">791</span><br /><span id="L792">792</span><br /><span id="L793">793</span><br /><span id="L794">794</span><br /><span id="L795">795</span><br /><span id="L796">796</span><br /><span id="L797">797</span><br /><span id="L798">798</span><br /><span id="L799">799</span><br /><span id="L800">800</span><br /><span id="L801">801</span><br /><span id="L802">802</span><br /><span id="L803">803</span><br /><span id="L804">804</span><br /><span id="L805">805</span><br /><span id="L806">806</span><br /><span id="L807">807</span><br /><span id="L808">808</span><br /><span id="L809">809</span><br /><span id="L810">810</span><br /><span id="L811">811</span><br /><span id="L812">812</span><br /><span id="L813">813</span><br /><span id="L814">814</span><br /><span id="L815">815</span><br /><span id="L816">816</span><br /><span id="L817">817</span><br /><span id="L818">818</span><br /><span id="L819">819</span><br /><span id="L820">820</span><br /><span id="L821">821</span><br /><span id="L822">822</span><br /><span id="L823">823</span><br /><span id="L824">824</span><br /><span id="L825">825</span><br /><span id="L826">826</span><br /><span id="L827">827</span><br /><span id="L828">828</span><br /><span id="L829">829</span><br /><span id="L830">830</span><br /><span id="L831">831</span><br /><span id="L832">832</span><br /><span id="L833">833</span><br /><span id="L834">834</span><br /><span id="L835">835</span><br /><span id="L836">836</span><br /><span id="L837">837</span><br /><span id="L838">838</span><br /><span id="L839">839</span><br /><span id="L840">840</span><br /><span id="L841">841</span><br /><span id="L842">842</span><br /><span id="L843">843</span><br /><span id="L844">844</span><br /><span id="L845">845</span><br /><span id="L846">846</span><br /><span id="L847">847</span><br /><span id="L848">848</span><br /><span id="L849">849</span><br /><span id="L850">850</span><br /><span id="L851">851</span><br /><span id="L852">852</span><br /><span id="L853">853</span><br /><span id="L854">854</span><br /><span id="L855">855</span><br /><span id="L856">856</span><br /><span id="L857">857</span><br /><span id="L858">858</span><br /><span id="L859">859</span><br /><span id="L860">860</span><br /><span id="L861">861</span><br /><span id="L862">862</span><br /><span id="L863">863</span><br /><span id="L864">864</span><br /><span id="L865">865</span><br /><span id="L866">866</span><br /><span id="L867">867</span><br /><span id="L868">868</span><br /><span id="L869">869</span><br /><span id="L870">870</span><br /><span id="L871">871</span><br /><span id="L872">872</span><br /><span id="L873">873</span><br /><span id="L874">874</span><br /><span id="L875">875</span><br /><span id="L876">876</span><br /><span id="L877">877</span><br /><span id="L878">878</span><br /><span id="L879">879</span><br /><span id="L880">880</span><br /><span id="L881">881</span><br /><span id="L882">882</span><br /><span id="L883">883</span><br /><span id="L884">884</span><br /><span id="L885">885</span><br /><span id="L886">886</span><br /><span id="L887">887</span><br /><span id="L888">888</span><br /><span id="L889">889</span><br /><span id="L890">890</span><br /><span id="L891">891</span><br /><span id="L892">892</span><br /><span id="L893">893</span><br /><span id="L894">894</span><br /><span id="L895">895</span><br /><span id="L896">896</span><br /><span id="L897">897</span><br /><span id="L898">898</span><br /><span id="L899">899</span><br /><span id="L900">900</span><br /><span id="L901">901</span><br /><span id="L902">902</span><br /><span id="L903">903</span><br /><span id="L904">904</span><br /><span id="L905">905</span><br /><span id="L906">906</span><br /><span id="L907">907</span><br /><span id="L908">908</span><br /><span id="L909">909</span><br /><span id="L910">910</span><br /><span id="L911">911</span><br /><span id="L912">912</span><br /><span id="L913">913</span><br /><span id="L914">914</span><br /><span id="L915">915</span><br /><span id="L916">916</span><br /><span id="L917">917</span><br /><span id="L918">918</span><br /><span id="L919">919</span><br /><span id="L920">920</span><br /><span id="L921">921</span><br /><span id="L922">922</span><br /><span id="L923">923</span><br /><span id="L924">924</span><br /><span id="L925">925</span><br /><span id="L926">926</span><br /><span id="L927">927</span><br /><span id="L928">928</span><br /><span id="L929">929</span><br /><span id="L930">930</span><br /><span id="L931">931</span><br /><span id="L932">932</span><br /><span id="L933">933</span><br /><span id="L934">934</span><br /><span id="L935">935</span><br /><span id="L936">936</span><br /><span id="L937">937</span><br /><span id="L938">938</span><br /><span id="L939">939</span><br /><span id="L940">940</span><br /><span id="L941">941</span><br /><span id="L942">942</span><br /><span id="L943">943</span><br /><span id="L944">944</span><br /><span id="L945">945</span><br /><span id="L946">946</span><br /><span id="L947">947</span><br /><span id="L948">948</span><br /><span id="L949">949</span><br /><span id="L950">950</span><br /><span id="L951">951</span><br /><span id="L952">952</span><br /><span id="L953">953</span><br /><span id="L954">954</span><br /><span id="L955">955</span><br /><span id="L956">956</span><br /><span id="L957">957</span><br /><span id="L958">958</span><br /><span id="L959">959</span><br /><span id="L960">960</span><br /><span id="L961">961</span><br /><span id="L962">962</span><br /><span id="L963">963</span><br /><span id="L964">964</span><br /><span id="L965">965</span><br /><span id="L966">966</span><br /><span id="L967">967</span><br /><span id="L968">968</span><br /><span id="L969">969</span><br /><span id="L970">970</span><br /><span id="L971">971</span><br /><span id="L972">972</span><br /><span id="L973">973</span><br /><span id="L974">974</span><br /><span id="L975">975</span><br /><span id="L976">976</span><br /><span id="L977">977</span><br /><span id="L978">978</span><br /><span id="L979">979</span><br /><span id="L980">980</span><br /><span id="L981">981</span><br /><span id="L982">982</span><br /><span id="L983">983</span><br /><span id="L984">984</span><br /><span id="L985">985</span><br /><span id="L986">986</span><br /><span id="L987">987</span><br /><span id="L988">988</span><br /><span id="L989">989</span><br /><span id="L990">990</span><br /><span id="L991">991</span><br /><span id="L992">992</span><br /><span id="L993">993</span><br /><span id="L994">994</span><br /><span id="L995">995</span><br /><span id="L996">996</span><br /><span id="L997">997</span><br /><span id="L998">998</span><br /><span id="L999">999</span><br /><span id="L1000">1000</span><br /><span id="L1001">1001</span><br /><span id="L1002">1002</span><br /><span id="L1003">1003</span><br /><span id="L1004">1004</span><br /><span id="L1005">1005</span><br /><span id="L1006">1006</span><br /><span id="L1007">1007</span><br /><span id="L1008">1008</span><br /><span id="L1009">1009</span><br /><span id="L1010">1010</span><br /><span id="L1011">1011</span><br /><span id="L1012">1012</span><br /><span id="L1013">1013</span><br /><span id="L1014">1014</span><br /><span id="L1015">1015</span><br /><span id="L1016">1016</span><br /><span id="L1017">1017</span><br /><span id="L1018">1018</span><br /><span id="L1019">1019</span><br /><span id="L1020">1020</span><br /><span id="L1021">1021</span><br /><span id="L1022">1022</span><br /><span id="L1023">1023</span><br /><span id="L1024">1024</span><br /><span id="L1025">1025</span><br /><span id="L1026">1026</span><br /><span id="L1027">1027</span><br /><span id="L1028">1028</span><br /><span id="L1029">1029</span><br /><span id="L1030">1030</span><br /><span id="L1031">1031</span><br /><span id="L1032">1032</span><br /><span id="L1033">1033</span><br /><span id="L1034">1034</span><br /><span id="L1035">1035</span><br /><span id="L1036">1036</span><br /><span id="L1037">1037</span><br /><span id="L1038">1038</span><br /><span id="L1039">1039</span><br /><span id="L1040">1040</span><br /><span id="L1041">1041</span><br /><span id="L1042">1042</span><br /><span id="L1043">1043</span><br /><span id="L1044">1044</span><br /><span id="L1045">1045</span><br /><span id="L1046">1046</span><br /><span id="L1047">1047</span><br /><span id="L1048">1048</span><br /><span id="L1049">1049</span><br /><span id="L1050">1050</span><br /><span id="L1051">1051</span><br /><span id="L1052">1052</span><br /><span id="L1053">1053</span><br /><span id="L1054">1054</span><br /><span id="L1055">1055</span><br /><span id="L1056">1056</span><br /><span id="L1057">1057</span><br /><span id="L1058">1058</span><br /><span id="L1059">1059</span><br /><span id="L1060">1060</span><br /><span id="L1061">1061</span><br /><span id="L1062">1062</span><br /><span id="L1063">1063</span><br /><span id="L1064">1064</span><br /><span id="L1065">1065</span><br /><span id="L1066">1066</span><br /><span id="L1067">1067</span><br /><span id="L1068">1068</span><br /><span id="L1069">1069</span><br /><span id="L1070">1070</span><br /><span id="L1071">1071</span><br /><span id="L1072">1072</span><br /><span id="L1073">1073</span><br /><span id="L1074">1074</span><br /><span id="L1075">1075</span><br /><span id="L1076">1076</span><br /><span id="L1077">1077</span><br /><span id="L1078">1078</span><br /><span id="L1079">1079</span><br /><span id="L1080">1080</span><br /><span id="L1081">1081</span><br /><span id="L1082">1082</span><br /><span id="L1083">1083</span><br /><span id="L1084">1084</span><br /><span id="L1085">1085</span><br /><span id="L1086">1086</span><br /><span id="L1087">1087</span><br /><span id="L1088">1088</span><br /><span id="L1089">1089</span><br /><span id="L1090">1090</span><br /><span id="L1091">1091</span><br /><span id="L1092">1092</span><br /><span id="L1093">1093</span><br /><span id="L1094">1094</span><br /><span id="L1095">1095</span><br /><span id="L1096">1096</span><br /><span id="L1097">1097</span><br /><span id="L1098">1098</span><br /><span id="L1099">1099</span><br /><span id="L1100">1100</span><br /><span id="L1101">1101</span><br /><span id="L1102">1102</span><br /><span id="L1103">1103</span><br /><span id="L1104">1104</span><br /><span id="L1105">1105</span><br /><span id="L1106">1106</span><br /><span id="L1107">1107</span><br /><span id="L1108">1108</span><br /><span id="L1109">1109</span><br /><span id="L1110">1110</span><br /><span id="L1111">1111</span><br /><span id="L1112">1112</span><br /><span id="L1113">1113</span><br /><span id="L1114">1114</span><br /><span id="L1115">1115</span><br /><span id="L1116">1116</span><br /><span id="L1117">1117</span><br /><span id="L1118">1118</span><br /><span id="L1119">1119</span><br /><span id="L1120">1120</span><br /><span id="L1121">1121</span><br /><span id="L1122">1122</span><br /><span id="L1123">1123</span><br /><span id="L1124">1124</span><br /><span id="L1125">1125</span><br /><span id="L1126">1126</span><br /><span id="L1127">1127</span><br /><span id="L1128">1128</span><br /><span id="L1129">1129</span><br /><span id="L1130">1130</span><br /><span id="L1131">1131</span><br /><span id="L1132">1132</span><br /><span id="L1133">1133</span><br /><span id="L1134">1134</span><br /><span id="L1135">1135</span><br /><span id="L1136">1136</span><br /><span id="L1137">1137</span><br /><span id="L1138">1138</span><br /><span id="L1139">1139</span><br /><span id="L1140">1140</span><br /><span id="L1141">1141</span><br /><span id="L1142">1142</span><br /><span id="L1143">1143</span><br /><span id="L1144">1144</span><br /><span id="L1145">1145</span><br /><span id="L1146">1146</span><br /><span id="L1147">1147</span><br /><span id="L1148">1148</span><br /><span id="L1149">1149</span><br /><span id="L1150">1150</span><br /><span id="L1151">1151</span><br /><span id="L1152">1152</span><br /><span id="L1153">1153</span><br /><span id="L1154">1154</span><br /><span id="L1155">1155</span><br /><span id="L1156">1156</span><br /><span id="L1157">1157</span><br /><span id="L1158">1158</span><br /><span id="L1159">1159</span><br /><span id="L1160">1160</span><br /><span id="L1161">1161</span><br /><span id="L1162">1162</span><br /><span id="L1163">1163</span><br /><span id="L1164">1164</span><br /><span id="L1165">1165</span><br /><span id="L1166">1166</span><br /><span id="L1167">1167</span><br /><span id="L1168">1168</span><br /><span id="L1169">1169</span><br /><span id="L1170">1170</span><br /><span id="L1171">1171</span><br /><span id="L1172">1172</span><br /><span id="L1173">1173</span><br /><span id="L1174">1174</span><br /><span id="L1175">1175</span><br /><span id="L1176">1176</span><br /><span id="L1177">1177</span><br /><span id="L1178">1178</span><br /><span id="L1179">1179</span><br /><span id="L1180">1180</span><br /><span id="L1181">1181</span><br /><span id="L1182">1182</span><br /><span id="L1183">1183</span><br /><span id="L1184">1184</span><br /><span id="L1185">1185</span><br /><span id="L1186">1186</span><br /><span id="L1187">1187</span><br /><span id="L1188">1188</span><br /><span id="L1189">1189</span><br /><span id="L1190">1190</span><br /><span id="L1191">1191</span><br /><span id="L1192">1192</span><br /><span id="L1193">1193</span><br /><span id="L1194">1194</span><br /><span id="L1195">1195</span><br /><span id="L1196">1196</span><br /><span id="L1197">1197</span><br /><span id="L1198">1198</span><br /><span id="L1199">1199</span><br /><span id="L1200">1200</span><br /><span id="L1201">1201</span><br /><span id="L1202">1202</span><br /><span id="L1203">1203</span><br /><span id="L1204">1204</span><br /><span id="L1205">1205</span><br /><span id="L1206">1206</span><br /><span id="L1207">1207</span><br /><span id="L1208">1208</span><br /><span id="L1209">1209</span><br /><span id="L1210">1210</span><br /><span id="L1211">1211</span><br /><span id="L1212">1212</span><br /><span id="L1213">1213</span><br /><span id="L1214">1214</span><br /><span id="L1215">1215</span><br /><span id="L1216">1216</span><br /><span id="L1217">1217</span><br /><span id="L1218">1218</span><br /><span id="L1219">1219</span><br /><span id="L1220">1220</span><br /><span id="L1221">1221</span><br /><span id="L1222">1222</span><br /><span id="L1223">1223</span><br /><span id="L1224">1224</span><br /><span id="L1225">1225</span><br /><span id="L1226">1226</span><br /><span id="L1227">1227</span><br /><span id="L1228">1228</span><br /><span id="L1229">1229</span><br /><span id="L1230">1230</span><br /><span id="L1231">1231</span><br /><span id="L1232">1232</span><br /><span id="L1233">1233</span><br /><span id="L1234">1234</span><br /><span id="L1235">1235</span><br /><span id="L1236">1236</span><br /><span id="L1237">1237</span><br /><span id="L1238">1238</span><br /><span id="L1239">1239</span><br /><span id="L1240">1240</span><br /><span id="L1241">1241</span><br /><span id="L1242">1242</span><br /><span id="L1243">1243</span><br /><span id="L1244">1244</span><br /><span id="L1245">1245</span><br /><span id="L1246">1246</span><br /><span id="L1247">1247</span><br /><span id="L1248">1248</span><br /><span id="L1249">1249</span><br /><span id="L1250">1250</span><br /><span id="L1251">1251</span><br /><span id="L1252">1252</span><br /><span id="L1253">1253</span><br /><span id="L1254">1254</span><br /><span id="L1255">1255</span><br /><span id="L1256">1256</span><br /><span id="L1257">1257</span><br /><span id="L1258">1258</span><br /><span id="L1259">1259</span><br /><span id="L1260">1260</span><br /><span id="L1261">1261</span><br /><span id="L1262">1262</span><br /><span id="L1263">1263</span><br /><span id="L1264">1264</span><br /><span id="L1265">1265</span><br /><span id="L1266">1266</span><br /><span id="L1267">1267</span><br /><span id="L1268">1268</span><br /><span id="L1269">1269</span><br /><span id="L1270">1270</span><br /><span id="L1271">1271</span><br /><span id="L1272">1272</span><br /><span id="L1273">1273</span><br /><span id="L1274">1274</span><br /><span id="L1275">1275</span><br /><span id="L1276">1276</span><br /><span id="L1277">1277</span><br /><span id="L1278">1278</span><br /><span id="L1279">1279</span><br /><span id="L1280">1280</span><br /><span id="L1281">1281</span><br /><span id="L1282">1282</span><br /><span id="L1283">1283</span><br /><span id="L1284">1284</span><br /><span id="L1285">1285</span><br /><span id="L1286">1286</span><br /><span id="L1287">1287</span><br /><span id="L1288">1288</span><br /><span id="L1289">1289</span><br /><span id="L1290">1290</span><br /><span id="L1291">1291</span><br /><span id="L1292">1292</span><br /><span id="L1293">1293</span><br /><span id="L1294">1294</span><br /><span id="L1295">1295</span><br /><span id="L1296">1296</span><br /><span id="L1297">1297</span><br /><span id="L1298">1298</span><br /><span id="L1299">1299</span><br /><span id="L1300">1300</span><br /><span id="L1301">1301</span><br /><span id="L1302">1302</span><br /><span id="L1303">1303</span><br /><span id="L1304">1304</span><br /><span id="L1305">1305</span><br /><span id="L1306">1306</span><br /><span id="L1307">1307</span><br /><span id="L1308">1308</span><br /><span id="L1309">1309</span><br /><span id="L1310">1310</span><br /><span id="L1311">1311</span><br /><span id="L1312">1312</span><br /><span id="L1313">1313</span><br /><span id="L1314">1314</span><br /><span id="L1315">1315</span><br /><span id="L1316">1316</span><br /><span id="L1317">1317</span><br /><span id="L1318">1318</span><br /><span id="L1319">1319</span><br /><span id="L1320">1320</span><br /><span id="L1321">1321</span><br /><span id="L1322">1322</span><br /><span id="L1323">1323</span><br /><span id="L1324">1324</span><br /><span id="L1325">1325</span><br /><span id="L1326">1326</span><br /><span id="L1327">1327</span><br /><span id="L1328">1328</span><br /><span id="L1329">1329</span><br /><span id="L1330">1330</span><br /><span id="L1331">1331</span><br /><span id="L1332">1332</span><br /><span id="L1333">1333</span><br /><span id="L1334">1334</span><br /><span id="L1335">1335</span><br /><span id="L1336">1336</span><br /><span id="L1337">1337</span><br /><span id="L1338">1338</span><br /><span id="L1339">1339</span><br /><span id="L1340">1340</span><br /><span id="L1341">1341</span><br /><span id="L1342">1342</span><br /><span id="L1343">1343</span><br /><span id="L1344">1344</span><br /><span id="L1345">1345</span><br /><span id="L1346">1346</span><br /><span id="L1347">1347</span><br /><span id="L1348">1348</span><br /><span id="L1349">1349</span><br /><span id="L1350">1350</span><br /><span id="L1351">1351</span><br /><span id="L1352">1352</span><br /><span id="L1353">1353</span><br /><span id="L1354">1354</span><br /><span id="L1355">1355</span><br /><span id="L1356">1356</span><br /><span id="L1357">1357</span><br /><span id="L1358">1358</span><br /><span id="L1359">1359</span><br /><span id="L1360">1360</span><br /><span id="L1361">1361</span><br /><span id="L1362">1362</span><br /><span id="L1363">1363</span><br /><span id="L1364">1364</span><br /><span id="L1365">1365</span><br /><span id="L1366">1366</span><br /><span id="L1367">1367</span><br /><span id="L1368">1368</span><br /><span id="L1369">1369</span><br /><span id="L1370">1370</span><br /><span id="L1371">1371</span><br /><span id="L1372">1372</span><br /><span id="L1373">1373</span><br /><span id="L1374">1374</span><br /><span id="L1375">1375</span><br /><span id="L1376">1376</span><br /><span id="L1377">1377</span><br /><span id="L1378">1378</span><br /><span id="L1379">1379</span><br /><span id="L1380">1380</span><br /><span id="L1381">1381</span><br /><span id="L1382">1382</span><br /><span id="L1383">1383</span><br /><span id="L1384">1384</span><br /><span id="L1385">1385</span><br /><span id="L1386">1386</span><br /><span id="L1387">1387</span><br /><span id="L1388">1388</span><br /><span id="L1389">1389</span><br /><span id="L1390">1390</span><br /><span id="L1391">1391</span><br /><span id="L1392">1392</span><br /><span id="L1393">1393</span><br /><span id="L1394">1394</span><br /><span id="L1395">1395</span><br /><span id="L1396">1396</span><br /><span id="L1397">1397</span><br /><span id="L1398">1398</span><br /><span id="L1399">1399</span><br /><span id="L1400">1400</span><br /><span id="L1401">1401</span><br /><span id="L1402">1402</span><br /><span id="L1403">1403</span><br /><span id="L1404">1404</span><br /><span id="L1405">1405</span><br /><span id="L1406">1406</span><br /><span id="L1407">1407</span><br /><span id="L1408">1408</span><br /><span id="L1409">1409</span><br /><span id="L1410">1410</span><br /><span id="L1411">1411</span><br /><span id="L1412">1412</span><br /><span id="L1413">1413</span><br /><span id="L1414">1414</span><br /><span id="L1415">1415</span><br /><span id="L1416">1416</span><br /><span id="L1417">1417</span><br /><span id="L1418">1418</span><br /><span id="L1419">1419</span><br /><span id="L1420">1420</span><br /><span id="L1421">1421</span><br /><span id="L1422">1422</span><br /><span id="L1423">1423</span><br /><span id="L1424">1424</span><br /><span id="L1425">1425</span><br /><span id="L1426">1426</span><br /><span id="L1427">1427</span><br /><span id="L1428">1428</span><br /><span id="L1429">1429</span><br /><span id="L1430">1430</span><br /><span id="L1431">1431</span><br /><span id="L1432">1432</span><br /><span id="L1433">1433</span><br /><span id="L1434">1434</span><br /><span id="L1435">1435</span><br /><span id="L1436">1436</span><br /><span id="L1437">1437</span><br /><span id="L1438">1438</span><br /><span id="L1439">1439</span><br /><span id="L1440">1440</span><br /><span id="L1441">1441</span><br /><span id="L1442">1442</span><br /><span id="L1443">1443</span><br /><span id="L1444">1444</span><br /><span id="L1445">1445</span><br /><span id="L1446">1446</span><br /><span id="L1447">1447</span><br /><span id="L1448">1448</span><br /><span id="L1449">1449</span><br /><span id="L1450">1450</span><br /><span id="L1451">1451</span><br /><span id="L1452">1452</span><br /><span id="L1453">1453</span><br /><span id="L1454">1454</span><br /><span id="L1455">1455</span><br /><span id="L1456">1456</span><br /><span id="L1457">1457</span><br /><span id="L1458">1458</span><br /><span id="L1459">1459</span><br /><span id="L1460">1460</span><br /><span id="L1461">1461</span><br /><span id="L1462">1462</span><br /><span id="L1463">1463</span><br /><span id="L1464">1464</span><br /><span id="L1465">1465</span><br /><span id="L1466">1466</span><br /><span id="L1467">1467</span><br /><span id="L1468">1468</span><br /><span id="L1469">1469</span><br /><span id="L1470">1470</span><br /><span id="L1471">1471</span><br /><span id="L1472">1472</span><br /><span id="L1473">1473</span><br /><span id="L1474">1474</span><br /><span id="L1475">1475</span><br /><span id="L1476">1476</span><br /><span id="L1477">1477</span><br /><span id="L1478">1478</span><br /><span id="L1479">1479</span><br /><span id="L1480">1480</span><br /><span id="L1481">1481</span><br /><span id="L1482">1482</span><br /><span id="L1483">1483</span><br /><span id="L1484">1484</span><br /><span id="L1485">1485</span><br /><span id="L1486">1486</span><br /><span id="L1487">1487</span><br /><span id="L1488">1488</span><br /><span id="L1489">1489</span><br /><span id="L1490">1490</span><br /><span id="L1491">1491</span><br /><span id="L1492">1492</span><br /><span id="L1493">1493</span><br /><span id="L1494">1494</span><br /><span id="L1495">1495</span><br /><span id="L1496">1496</span><br /><span id="L1497">1497</span><br /><span id="L1498">1498</span><br /><span id="L1499">1499</span><br /><span id="L1500">1500</span><br /><span id="L1501">1501</span><br /><span id="L1502">1502</span><br /><span id="L1503">1503</span><br /><span id="L1504">1504</span><br /><span id="L1505">1505</span><br /><span id="L1506">1506</span><br /><span id="L1507">1507</span><br /><span id="L1508">1508</span><br /><span id="L1509">1509</span><br /><span id="L1510">1510</span><br /><span id="L1511">1511</span><br /><span id="L1512">1512</span><br /><span id="L1513">1513</span><br /><span id="L1514">1514</span><br /><span id="L1515">1515</span><br /><span id="L1516">1516</span><br /><span id="L1517">1517</span><br /><span id="L1518">1518</span><br /><span id="L1519">1519</span><br /><span id="L1520">1520</span><br /><span id="L1521">1521</span><br /><span id="L1522">1522</span><br /><span id="L1523">1523</span><br /><span id="L1524">1524</span><br /><span id="L1525">1525</span><br /><span id="L1526">1526</span><br /><span id="L1527">1527</span><br /><span id="L1528">1528</span><br /><span id="L1529">1529</span><br /><span id="L1530">1530</span><br /><span id="L1531">1531</span><br /><span id="L1532">1532</span><br /><span id="L1533">1533</span><br /><span id="L1534">1534</span><br /><span id="L1535">1535</span><br /><span id="L1536">1536</span><br /><span id="L1537">1537</span><br /><span id="L1538">1538</span><br /><span id="L1539">1539</span><br /><span id="L1540">1540</span><br /><span id="L1541">1541</span><br /><span id="L1542">1542</span><br /><span id="L1543">1543</span><br /><span id="L1544">1544</span><br /><span id="L1545">1545</span><br /><span id="L1546">1546</span><br /><span id="L1547">1547</span><br /><span id="L1548">1548</span><br /><span id="L1549">1549</span><br /><span id="L1550">1550</span><br /><span id="L1551">1551</span><br /><span id="L1552">1552</span><br /><span id="L1553">1553</span><br /><span id="L1554">1554</span><br /><span id="L1555">1555</span><br /><span id="L1556">1556</span><br /><span id="L1557">1557</span><br /><span id="L1558">1558</span><br /><span id="L1559">1559</span><br /><span id="L1560">1560</span><br /><span id="L1561">1561</span><br /><span id="L1562">1562</span><br /><span id="L1563">1563</span><br /><span id="L1564">1564</span><br /><span id="L1565">1565</span><br /><span id="L1566">1566</span><br /><span id="L1567">1567</span><br /><span id="L1568">1568</span><br /><span id="L1569">1569</span><br /><span id="L1570">1570</span><br /><span id="L1571">1571</span><br /><span id="L1572">1572</span><br /><span id="L1573">1573</span><br /><span id="L1574">1574</span><br /><span id="L1575">1575</span><br /><span id="L1576">1576</span><br /><span id="L1577">1577</span><br /><span id="L1578">1578</span><br /><span id="L1579">1579</span><br /><span id="L1580">1580</span><br /><span id="L1581">1581</span><br /><span id="L1582">1582</span><br /><span id="L1583">1583</span><br /><span id="L1584">1584</span><br /><span id="L1585">1585</span><br /><span id="L1586">1586</span><br /><span id="L1587">1587</span><br /><span id="L1588">1588</span><br /><span id="L1589">1589</span><br /><span id="L1590">1590</span><br /><span id="L1591">1591</span><br /><span id="L1592">1592</span><br /><span id="L1593">1593</span><br /><span id="L1594">1594</span><br /><span id="L1595">1595</span><br /><span id="L1596">1596</span><br /><span id="L1597">1597</span><br /><span id="L1598">1598</span><br /><span id="L1599">1599</span><br /><span id="L1600">1600</span><br /><span id="L1601">1601</span><br /><span id="L1602">1602</span><br /><span id="L1603">1603</span><br /><span id="L1604">1604</span><br /><span id="L1605">1605</span><br /><span id="L1606">1606</span><br /><span id="L1607">1607</span><br /><span id="L1608">1608</span><br /><span id="L1609">1609</span><br /><span id="L1610">1610</span><br /><span id="L1611">1611</span><br /><span id="L1612">1612</span><br /><span id="L1613">1613</span><br /><span id="L1614">1614</span><br /><span id="L1615">1615</span><br /><span id="L1616">1616</span><br /><span id="L1617">1617</span><br /><span id="L1618">1618</span><br /><span id="L1619">1619</span><br /><span id="L1620">1620</span><br /><span id="L1621">1621</span><br /><span id="L1622">1622</span><br /><span id="L1623">1623</span><br /><span id="L1624">1624</span><br /><span id="L1625">1625</span><br /><span id="L1626">1626</span><br /><span id="L1627">1627</span><br /><span id="L1628">1628</span><br /><span id="L1629">1629</span><br /><span id="L1630">1630</span><br /><span id="L1631">1631</span><br /><span id="L1632">1632</span><br /><span id="L1633">1633</span><br /><span id="L1634">1634</span><br /><span id="L1635">1635</span><br /><span id="L1636">1636</span><br /><span id="L1637">1637</span><br /><span id="L1638">1638</span><br /><span id="L1639">1639</span><br /><span id="L1640">1640</span><br /><span id="L1641">1641</span><br /><span id="L1642">1642</span><br /><span id="L1643">1643</span><br /><span id="L1644">1644</span><br /><span id="L1645">1645</span><br /><span id="L1646">1646</span><br /><span id="L1647">1647</span><br /><span id="L1648">1648</span><br /><span id="L1649">1649</span><br /><span id="L1650">1650</span><br /><span id="L1651">1651</span><br /><span id="L1652">1652</span><br /><span id="L1653">1653</span><br /><span id="L1654">1654</span><br /><span id="L1655">1655</span><br /><span id="L1656">1656</span><br /><span id="L1657">1657</span><br /><span id="L1658">1658</span><br /><span id="L1659">1659</span><br /><span id="L1660">1660</span><br /><span id="L1661">1661</span><br /><span id="L1662">1662</span><br /><span id="L1663">1663</span><br /><span id="L1664">1664</span><br /><span id="L1665">1665</span><br /><span id="L1666">1666</span><br /><span id="L1667">1667</span><br /><span id="L1668">1668</span><br /><span id="L1669">1669</span><br /><span id="L1670">1670</span><br /><span id="L1671">1671</span><br /><span id="L1672">1672</span><br /><span id="L1673">1673</span><br /><span id="L1674">1674</span><br /><span id="L1675">1675</span><br /><span id="L1676">1676</span><br /><span id="L1677">1677</span><br /><span id="L1678">1678</span><br /><span id="L1679">1679</span><br /><span id="L1680">1680</span><br /><span id="L1681">1681</span><br /><span id="L1682">1682</span><br /><span id="L1683">1683</span><br /><span id="L1684">1684</span><br /><span id="L1685">1685</span><br /><span id="L1686">1686</span><br /><span id="L1687">1687</span><br /><span id="L1688">1688</span><br /><span id="L1689">1689</span><br /><span id="L1690">1690</span><br /><span id="L1691">1691</span><br /><span id="L1692">1692</span><br /><span id="L1693">1693</span><br /><span id="L1694">1694</span><br /><span id="L1695">1695</span><br /><span id="L1696">1696</span><br /><span id="L1697">1697</span><br /><span id="L1698">1698</span><br /><span id="L1699">1699</span><br /><span id="L1700">1700</span><br /><span id="L1701">1701</span><br /><span id="L1702">1702</span><br /><span id="L1703">1703</span><br /><span id="L1704">1704</span><br /><span id="L1705">1705</span><br /><span id="L1706">1706</span><br /><span id="L1707">1707</span><br /><span id="L1708">1708</span><br /><span id="L1709">1709</span><br /><span id="L1710">1710</span><br /><span id="L1711">1711</span><br /><span id="L1712">1712</span><br /><span id="L1713">1713</span><br /><span id="L1714">1714</span><br /><span id="L1715">1715</span><br /><span id="L1716">1716</span><br /><span id="L1717">1717</span><br /><span id="L1718">1718</span><br /><span id="L1719">1719</span><br /><span id="L1720">1720</span><br /><span id="L1721">1721</span><br /><span id="L1722">1722</span><br /><span id="L1723">1723</span><br /><span id="L1724">1724</span><br /><span id="L1725">1725</span><br /><span id="L1726">1726</span><br /><span id="L1727">1727</span><br /><span id="L1728">1728</span><br /><span id="L1729">1729</span><br /><span id="L1730">1730</span><br /><span id="L1731">1731</span><br /><span id="L1732">1732</span><br /><span id="L1733">1733</span><br /><span id="L1734">1734</span><br /><span id="L1735">1735</span><br /><span id="L1736">1736</span><br /><span id="L1737">1737</span><br /><span id="L1738">1738</span><br /><span id="L1739">1739</span><br /><span id="L1740">1740</span><br /><span id="L1741">1741</span><br /><span id="L1742">1742</span><br /><span id="L1743">1743</span><br /><span id="L1744">1744</span><br /><span id="L1745">1745</span><br /><span id="L1746">1746</span><br /><span id="L1747">1747</span><br /><span id="L1748">1748</span><br /><span id="L1749">1749</span><br /><span id="L1750">1750</span><br /><span id="L1751">1751</span><br /><span id="L1752">1752</span><br /><span id="L1753">1753</span><br /><span id="L1754">1754</span><br /><span id="L1755">1755</span><br /><span id="L1756">1756</span><br /><span id="L1757">1757</span><br /><span id="L1758">1758</span><br /><span id="L1759">1759</span><br /><span id="L1760">1760</span><br /><span id="L1761">1761</span><br /><span id="L1762">1762</span><br /><span id="L1763">1763</span><br /><span id="L1764">1764</span><br /><span id="L1765">1765</span><br /><span id="L1766">1766</span><br /><span id="L1767">1767</span><br /><span id="L1768">1768</span><br /><span id="L1769">1769</span><br /><span id="L1770">1770</span><br /><span id="L1771">1771</span><br /><span id="L1772">1772</span><br /><span id="L1773">1773</span><br /><span id="L1774">1774</span><br /><span id="L1775">1775</span><br /><span id="L1776">1776</span><br /><span id="L1777">1777</span><br /><span id="L1778">1778</span><br /><span id="L1779">1779</span><br /><span id="L1780">1780</span><br /><span id="L1781">1781</span><br /><span id="L1782">1782</span><br /><span id="L1783">1783</span><br /><span id="L1784">1784</span><br /><span id="L1785">1785</span><br /><span id="L1786">1786</span><br /><span id="L1787">1787</span><br /><span id="L1788">1788</span><br /><span id="L1789">1789</span><br /><span id="L1790">1790</span><br /><span id="L1791">1791</span><br /><span id="L1792">1792</span><br /><span id="L1793">1793</span><br /><span id="L1794">1794</span><br /><span id="L1795">1795</span><br /><span id="L1796">1796</span><br /><span id="L1797">1797</span><br /><span id="L1798">1798</span><br /><span id="L1799">1799</span><br /><span id="L1800">1800</span><br /><span id="L1801">1801</span><br /><span id="L1802">1802</span><br /><span id="L1803">1803</span><br /><span id="L1804">1804</span><br /><span id="L1805">1805</span><br /><span id="L1806">1806</span><br /><span id="L1807">1807</span><br /><span id="L1808">1808</span><br /><span id="L1809">1809</span><br /><span id="L1810">1810</span><br /><span id="L1811">1811</span><br /><span id="L1812">1812</span><br /><span id="L1813">1813</span><br /><span id="L1814">1814</span><br /><span id="L1815">1815</span><br /><span id="L1816">1816</span><br /><span id="L1817">1817</span><br /><span id="L1818">1818</span><br /><span id="L1819">1819</span><br /><span id="L1820">1820</span><br /><span id="L1821">1821</span><br /><span id="L1822">1822</span><br /><span id="L1823">1823</span><br /><span id="L1824">1824</span><br /><span id="L1825">1825</span><br /><span id="L1826">1826</span><br /><span id="L1827">1827</span><br /><span id="L1828">1828</span><br /><span id="L1829">1829</span><br /><span id="L1830">1830</span><br /><span id="L1831">1831</span><br /><span id="L1832">1832</span><br /><span id="L1833">1833</span><br /><span id="L1834">1834</span><br /><span id="L1835">1835</span><br /><span id="L1836">1836</span><br /><span id="L1837">1837</span><br /><span id="L1838">1838</span><br /><span id="L1839">1839</span><br /><span id="L1840">1840</span><br /><span id="L1841">1841</span><br /><span id="L1842">1842</span><br /><span id="L1843">1843</span><br /><span id="L1844">1844</span><br /><span id="L1845">1845</span><br /><span id="L1846">1846</span><br /><span id="L1847">1847</span><br /><span id="L1848">1848</span><br /><span id="L1849">1849</span><br /><span id="L1850">1850</span><br /><span id="L1851">1851</span><br /><span id="L1852">1852</span><br /><span id="L1853">1853</span><br /><span id="L1854">1854</span><br /><span id="L1855">1855</span><br /><span id="L1856">1856</span><br /><span id="L1857">1857</span><br /><span id="L1858">1858</span><br /><span id="L1859">1859</span><br /><span id="L1860">1860</span><br /><span id="L1861">1861</span><br /><span id="L1862">1862</span><br /><span id="L1863">1863</span><br /><span id="L1864">1864</span><br /><span id="L1865">1865</span><br /><span id="L1866">1866</span><br /><span id="L1867">1867</span><br /><span id="L1868">1868</span><br /><span id="L1869">1869</span><br /><span id="L1870">1870</span><br /><span id="L1871">1871</span><br /><span id="L1872">1872</span><br /><span id="L1873">1873</span><br /><span id="L1874">1874</span><br /><span id="L1875">1875</span><br /><span id="L1876">1876</span><br /><span id="L1877">1877</span><br /><span id="L1878">1878</span><br /><span id="L1879">1879</span><br /><span id="L1880">1880</span><br /><span id="L1881">1881</span><br /><span id="L1882">1882</span><br /><span id="L1883">1883</span><br /><span id="L1884">1884</span><br /><span id="L1885">1885</span><br /><span id="L1886">1886</span><br /><span id="L1887">1887</span><br /><span id="L1888">1888</span><br /><span id="L1889">1889</span><br /><span id="L1890">1890</span><br /><span id="L1891">1891</span><br /><span id="L1892">1892</span><br /><span id="L1893">1893</span><br /><span id="L1894">1894</span><br /><span id="L1895">1895</span><br /><span id="L1896">1896</span><br /><span id="L1897">1897</span><br /><span id="L1898">1898</span><br /><span id="L1899">1899</span><br /><span id="L1900">1900</span><br /><span id="L1901">1901</span><br /><span id="L1902">1902</span><br /><span id="L1903">1903</span><br /><span id="L1904">1904</span><br /><span id="L1905">1905</span><br /><span id="L1906">1906</span><br /><span id="L1907">1907</span><br /><span id="L1908">1908</span><br /><span id="L1909">1909</span><br /><span id="L1910">1910</span><br /><span id="L1911">1911</span><br /><span id="L1912">1912</span><br /><span id="L1913">1913</span><br /><span id="L1914">1914</span><br /><span id="L1915">1915</span><br /><span id="L1916">1916</span><br /><span id="L1917">1917</span><br /><span id="L1918">1918</span><br /><span id="L1919">1919</span><br /><span id="L1920">1920</span><br /><span id="L1921">1921</span><br /><span id="L1922">1922</span><br /><span id="L1923">1923</span><br /><span id="L1924">1924</span><br /><span id="L1925">1925</span><br /><span id="L1926">1926</span><br /><span id="L1927">1927</span><br /><span id="L1928">1928</span><br /><span id="L1929">1929</span><br /><span id="L1930">1930</span><br /><span id="L1931">1931</span><br /><span id="L1932">1932</span><br /><span id="L1933">1933</span><br /><span id="L1934">1934</span><br /><span id="L1935">1935</span><br /><span id="L1936">1936</span><br /><span id="L1937">1937</span><br /><span id="L1938">1938</span><br /><span id="L1939">1939</span><br /><span id="L1940">1940</span><br /><span id="L1941">1941</span><br /><span id="L1942">1942</span><br /><span id="L1943">1943</span><br /><span id="L1944">1944</span><br /><span id="L1945">1945</span><br /><span id="L1946">1946</span><br /><span id="L1947">1947</span><br /><span id="L1948">1948</span><br /><span id="L1949">1949</span><br /><span id="L1950">1950</span><br /><span id="L1951">1951</span><br /><span id="L1952">1952</span><br /><span id="L1953">1953</span><br /><span id="L1954">1954</span><br /><span id="L1955">1955</span><br /><span id="L1956">1956</span><br /><span id="L1957">1957</span><br /><span id="L1958">1958</span><br /><span id="L1959">1959</span><br /><span id="L1960">1960</span><br /><span id="L1961">1961</span><br /><span id="L1962">1962</span><br /><span id="L1963">1963</span><br /><span id="L1964">1964</span><br /><span id="L1965">1965</span><br /><span id="L1966">1966</span><br /><span id="L1967">1967</span><br /><span id="L1968">1968</span><br /><span id="L1969">1969</span><br /><span id="L1970">1970</span><br /><span id="L1971">1971</span><br /><span id="L1972">1972</span><br /><span id="L1973">1973</span><br /><span id="L1974">1974</span><br /><span id="L1975">1975</span><br /><span id="L1976">1976</span><br /><span id="L1977">1977</span><br /><span id="L1978">1978</span><br /><span id="L1979">1979</span><br /><span id="L1980">1980</span><br /><span id="L1981">1981</span><br /><span id="L1982">1982</span><br /><span id="L1983">1983</span><br /><span id="L1984">1984</span><br /><span id="L1985">1985</span><br /><span id="L1986">1986</span><br /><span id="L1987">1987</span><br /><span id="L1988">1988</span><br /><span id="L1989">1989</span><br /><span id="L1990">1990</span><br /><span id="L1991">1991</span><br /><span id="L1992">1992</span><br /><span id="L1993">1993</span><br /><span id="L1994">1994</span><br /><span id="L1995">1995</span><br /><span id="L1996">1996</span><br /><span id="L1997">1997</span><br /><span id="L1998">1998</span><br /><span id="L1999">1999</span><br /><span id="L2000">2000</span><br /><span id="L2001">2001</span><br /><span id="L2002">2002</span><br /><span id="L2003">2003</span><br /><span id="L2004">2004</span><br /><span id="L2005">2005</span><br /><span id="L2006">2006</span><br /><span id="L2007">2007</span><br /><span id="L2008">2008</span><br /><span id="L2009">2009</span><br /><span id="L2010">2010</span><br /><span id="L2011">2011</span><br /><span id="L2012">2012</span><br /><span id="L2013">2013</span><br /><span id="L2014">2014</span><br /><span id="L2015">2015</span><br /><span id="L2016">2016</span><br /><span id="L2017">2017</span><br /><span id="L2018">2018</span><br /><span id="L2019">2019</span><br /><span id="L2020">2020</span><br /><span id="L2021">2021</span><br /><span id="L2022">2022</span><br /><span id="L2023">2023</span><br /><span id="L2024">2024</span><br /><span id="L2025">2025</span><br /><span id="L2026">2026</span><br /><span id="L2027">2027</span><br /><span id="L2028">2028</span><br /><span id="L2029">2029</span><br /><span id="L2030">2030</span><br /><span id="L2031">2031</span><br /><span id="L2032">2032</span><br /><span id="L2033">2033</span><br /><span id="L2034">2034</span><br /><span id="L2035">2035</span><br /><span id="L2036">2036</span><br /><span id="L2037">2037</span><br /><span id="L2038">2038</span><br /><span id="L2039">2039</span><br /><span id="L2040">2040</span><br /><span id="L2041">2041</span><br /><span id="L2042">2042</span><br /><span id="L2043">2043</span><br /><span id="L2044">2044</span><br /><span id="L2045">2045</span><br /><span id="L2046">2046</span><br /><span id="L2047">2047</span><br /><span id="L2048">2048</span><br /><span id="L2049">2049</span><br /><span id="L2050">2050</span><br /><span id="L2051">2051</span><br /><span id="L2052">2052</span><br /><span id="L2053">2053</span><br /><span id="L2054">2054</span><br /><span id="L2055">2055</span><br /><span id="L2056">2056</span><br /><span id="L2057">2057</span><br /><span id="L2058">2058</span><br /><span id="L2059">2059</span><br /><span id="L2060">2060</span><br /><span id="L2061">2061</span><br /><span id="L2062">2062</span><br /><span id="L2063">2063</span><br /><span id="L2064">2064</span><br /><span id="L2065">2065</span><br /><span id="L2066">2066</span><br /><span id="L2067">2067</span><br /><span id="L2068">2068</span><br /><span id="L2069">2069</span><br /><span id="L2070">2070</span><br /><span id="L2071">2071</span><br /><span id="L2072">2072</span><br /><span id="L2073">2073</span><br /><span id="L2074">2074</span><br /><span id="L2075">2075</span><br /><span id="L2076">2076</span><br /><span id="L2077">2077</span><br /><span id="L2078">2078</span><br /><span id="L2079">2079</span><br /><span id="L2080">2080</span><br /><span id="L2081">2081</span><br /><span id="L2082">2082</span><br /><span id="L2083">2083</span><br /><span id="L2084">2084</span><br /><span id="L2085">2085</span><br /><span id="L2086">2086</span><br /><span id="L2087">2087</span><br /><span id="L2088">2088</span><br /><span id="L2089">2089</span><br /><span id="L2090">2090</span><br /><span id="L2091">2091</span><br /><span id="L2092">2092</span><br /><span id="L2093">2093</span><br /><span id="L2094">2094</span><br /><span id="L2095">2095</span><br /><span id="L2096">2096</span><br /><span id="L2097">2097</span><br /><span id="L2098">2098</span><br /><span id="L2099">2099</span><br /><span id="L2100">2100</span><br /><span id="L2101">2101</span><br /><span id="L2102">2102</span><br /><span id="L2103">2103</span><br /><span id="L2104">2104</span><br /><span id="L2105">2105</span><br /><span id="L2106">2106</span><br /><span id="L2107">2107</span><br /><span id="L2108">2108</span><br /><span id="L2109">2109</span><br /><span id="L2110">2110</span><br /><span id="L2111">2111</span><br /><span id="L2112">2112</span><br /><span id="L2113">2113</span><br /><span id="L2114">2114</span><br /><span id="L2115">2115</span><br /><span id="L2116">2116</span><br /><span id="L2117">2117</span><br /><span id="L2118">2118</span><br /><span id="L2119">2119</span><br /><span id="L2120">2120</span><br /><span id="L2121">2121</span><br /><span id="L2122">2122</span><br /><span id="L2123">2123</span><br /><span id="L2124">2124</span><br /><span id="L2125">2125</span><br /><span id="L2126">2126</span><br /><span id="L2127">2127</span><br /><span id="L2128">2128</span><br /><span id="L2129">2129</span><br /><span id="L2130">2130</span><br /><span id="L2131">2131</span><br /><span id="L2132">2132</span><br /><span id="L2133">2133</span><br /><span id="L2134">2134</span><br /><span id="L2135">2135</span><br /><span id="L2136">2136</span><br /><span id="L2137">2137</span><br /><span id="L2138">2138</span><br /><span id="L2139">2139</span><br /><span id="L2140">2140</span><br /><span id="L2141">2141</span><br /><span id="L2142">2142</span><br /><span id="L2143">2143</span><br /><span id="L2144">2144</span><br /><span id="L2145">2145</span><br /><span id="L2146">2146</span><br /><span id="L2147">2147</span><br /><span id="L2148">2148</span><br /><span id="L2149">2149</span><br /><span id="L2150">2150</span><br /><span id="L2151">2151</span><br /><span id="L2152">2152</span><br /><span id="L2153">2153</span><br /><span id="L2154">2154</span><br /><span id="L2155">2155</span><br /><span id="L2156">2156</span><br /><span id="L2157">2157</span><br /><span id="L2158">2158</span><br /><span id="L2159">2159</span><br /><span id="L2160">2160</span><br /><span id="L2161">2161</span><br /><span id="L2162">2162</span><br /><span id="L2163">2163</span><br /><span id="L2164">2164</span><br /><span id="L2165">2165</span><br /><span id="L2166">2166</span><br /><span id="L2167">2167</span><br /><span id="L2168">2168</span><br /><span id="L2169">2169</span><br /><span id="L2170">2170</span><br /><span id="L2171">2171</span><br /><span id="L2172">2172</span><br /><span id="L2173">2173</span><br /><span id="L2174">2174</span><br /><span id="L2175">2175</span><br /><span id="L2176">2176</span><br /><span id="L2177">2177</span><br /><span id="L2178">2178</span><br /><span id="L2179">2179</span><br /><span id="L2180">2180</span><br /><span id="L2181">2181</span><br /><span id="L2182">2182</span><br /><span id="L2183">2183</span><br /><span id="L2184">2184</span><br /><span id="L2185">2185</span><br /><span id="L2186">2186</span><br /><span id="L2187">2187</span><br /><span id="L2188">2188</span><br /><span id="L2189">2189</span><br /><span id="L2190">2190</span><br /><span id="L2191">2191</span><br /><span id="L2192">2192</span><br /><span id="L2193">2193</span><br /><span id="L2194">2194</span><br /><span id="L2195">2195</span><br /><span id="L2196">2196</span><br /><span id="L2197">2197</span><br /><span id="L2198">2198</span><br /><span id="L2199">2199</span><br /><span id="L2200">2200</span><br /><span id="L2201">2201</span><br /><span id="L2202">2202</span><br /><span id="L2203">2203</span><br /><span id="L2204">2204</span><br /><span id="L2205">2205</span><br /><span id="L2206">2206</span><br /><span id="L2207">2207</span><br /><span id="L2208">2208</span><br /><span id="L2209">2209</span><br /><span id="L2210">2210</span><br /><span id="L2211">2211</span><br /><span id="L2212">2212</span><br /><span id="L2213">2213</span><br /><span id="L2214">2214</span><br /><span id="L2215">2215</span><br /><span id="L2216">2216</span><br /><span id="L2217">2217</span><br /><span id="L2218">2218</span><br /><span id="L2219">2219</span><br /><span id="L2220">2220</span><br /><span id="L2221">2221</span><br /><span id="L2222">2222</span><br /><span id="L2223">2223</span><br /><span id="L2224">2224</span><br /><span id="L2225">2225</span><br /><span id="L2226">2226</span><br /><span id="L2227">2227</span><br /><span id="L2228">2228</span><br /><span id="L2229">2229</span><br /><span id="L2230">2230</span><br /><span id="L2231">2231</span><br /><span id="L2232">2232</span><br /><span id="L2233">2233</span><br /><span id="L2234">2234</span><br /><span id="L2235">2235</span><br /><span id="L2236">2236</span><br /><span id="L2237">2237</span><br /><span id="L2238">2238</span><br /><span id="L2239">2239</span><br /><span id="L2240">2240</span><br /><span id="L2241">2241</span><br /><span id="L2242">2242</span><br /><span id="L2243">2243</span><br /><span id="L2244">2244</span><br /><span id="L2245">2245</span><br /><span id="L2246">2246</span><br /><span id="L2247">2247</span><br /><span id="L2248">2248</span><br /><span id="L2249">2249</span><br /><span id="L2250">2250</span><br /><span id="L2251">2251</span><br /><span id="L2252">2252</span><br /><span id="L2253">2253</span><br /><span id="L2254">2254</span><br /><span id="L2255">2255</span><br /><span id="L2256">2256</span><br /><span id="L2257">2257</span><br /><span id="L2258">2258</span><br /><span id="L2259">2259</span><br /><span id="L2260">2260</span><br /><span id="L2261">2261</span><br /><span id="L2262">2262</span><br /><span id="L2263">2263</span><br /><span id="L2264">2264</span><br /><span id="L2265">2265</span><br /><span id="L2266">2266</span><br /><span id="L2267">2267</span><br /><span id="L2268">2268</span><br /><span id="L2269">2269</span><br /><span id="L2270">2270</span><br /><span id="L2271">2271</span><br /><span id="L2272">2272</span><br /><span id="L2273">2273</span><br /><span id="L2274">2274</span><br /><span id="L2275">2275</span><br /><span id="L2276">2276</span><br /><span id="L2277">2277</span><br /><span id="L2278">2278</span><br /><span id="L2279">2279</span><br /><span id="L2280">2280</span><br /><span id="L2281">2281</span><br /><span id="L2282">2282</span><br /><span id="L2283">2283</span><br /><span id="L2284">2284</span><br /><span id="L2285">2285</span><br /><span id="L2286">2286</span><br /><span id="L2287">2287</span><br /><span id="L2288">2288</span><br /><span id="L2289">2289</span><br /><span id="L2290">2290</span><br /><span id="L2291">2291</span><br /><span id="L2292">2292</span><br /><span id="L2293">2293</span><br /><span id="L2294">2294</span><br /><span id="L2295">2295</span><br /><span id="L2296">2296</span><br /><span id="L2297">2297</span><br /><span id="L2298">2298</span><br /><span id="L2299">2299</span><br /><span id="L2300">2300</span><br /><span id="L2301">2301</span><br /><span id="L2302">2302</span><br /><span id="L2303">2303</span><br /><span id="L2304">2304</span><br /><span id="L2305">2305</span><br /><span id="L2306">2306</span><br /><span id="L2307">2307</span><br /><span id="L2308">2308</span><br /><span id="L2309">2309</span><br /><span id="L2310">2310</span><br /><span id="L2311">2311</span><br /><span id="L2312">2312</span><br /><span id="L2313">2313</span><br /><span id="L2314">2314</span><br /><span id="L2315">2315</span><br /><span id="L2316">2316</span><br /><span id="L2317">2317</span><br /><span id="L2318">2318</span><br /><span id="L2319">2319</span><br /><span id="L2320">2320</span><br /><span id="L2321">2321</span><br /><span id="L2322">2322</span><br /><span id="L2323">2323</span><br /><span id="L2324">2324</span><br /><span id="L2325">2325</span><br /><span id="L2326">2326</span><br /><span id="L2327">2327</span><br /><span id="L2328">2328</span><br /><span id="L2329">2329</span><br /><span id="L2330">2330</span><br /><span id="L2331">2331</span><br /><span id="L2332">2332</span><br /><span id="L2333">2333</span><br /><span id="L2334">2334</span><br /><span id="L2335">2335</span><br /><span id="L2336">2336</span><br /><span id="L2337">2337</span><br /><span id="L2338">2338</span><br /><span id="L2339">2339</span><br /><span id="L2340">2340</span><br /><span id="L2341">2341</span><br /><span id="L2342">2342</span><br /><span id="L2343">2343</span><br /><span id="L2344">2344</span><br /><span id="L2345">2345</span><br /><span id="L2346">2346</span><br /><span id="L2347">2347</span><br /></div>
<div id="sail-html-source"><span class="sail-comment">/*=======================================================================================*/</span>
<span class="sail-comment">/*  This Sail RISC-V architecture model, comprising all files and                        */</span>
<span class="sail-comment">/*  directories except where otherwise noted is subject the BSD                          */</span>
<span class="sail-comment">/*  two-clause license in the LICENSE file.                                              */</span>
<span class="sail-comment">/*                                                                                       */</span>
<span class="sail-comment">/*  SPDX-License-Identifier: BSD-2-Clause                                                */</span>
<span class="sail-comment">/*=======================================================================================*/</span>

<span class="sail-comment">/* ******************************************************************************* */</span>
<span class="sail-comment">/* This file implements part of the vector extension.                              */</span>
<span class="sail-comment">/* Chapter 11: Vector Integer Arithmetic Instructions                              */</span>
<span class="sail-comment">/* Chapter 12: Vector Fixed-Point Arithmetic Instructions                          */</span>
<span class="sail-comment">/* Chapter 16: Vector Permutation Instructions (integer part)                      */</span>
<span class="sail-comment">/* ******************************************************************************* */</span>

<span class="sail-comment">/* ******************************* OPIVV (VVTYPE) ******************************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">VVTYPE</span> : (<span class="sail-id">vvfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_vvfunct6</span> : <span class="sail-id">vvfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">VV_VADD</span>          &lt;-&gt; <span class="sail-literal">0b000000</span>,
  <span class="sail-id">VV_VSUB</span>          &lt;-&gt; <span class="sail-literal">0b000010</span>,
  <span class="sail-id">VV_VMINU</span>         &lt;-&gt; <span class="sail-literal">0b000100</span>,
  <span class="sail-id">VV_VMIN</span>          &lt;-&gt; <span class="sail-literal">0b000101</span>,
  <span class="sail-id">VV_VMAXU</span>         &lt;-&gt; <span class="sail-literal">0b000110</span>,
  <span class="sail-id">VV_VMAX</span>          &lt;-&gt; <span class="sail-literal">0b000111</span>,
  <span class="sail-id">VV_VAND</span>          &lt;-&gt; <span class="sail-literal">0b001001</span>,
  <span class="sail-id">VV_VOR</span>           &lt;-&gt; <span class="sail-literal">0b001010</span>,
  <span class="sail-id">VV_VXOR</span>          &lt;-&gt; <span class="sail-literal">0b001011</span>,
  <span class="sail-id">VV_VRGATHER</span>      &lt;-&gt; <span class="sail-literal">0b001100</span>,
  <span class="sail-id">VV_VRGATHEREI16</span>  &lt;-&gt; <span class="sail-literal">0b001110</span>,
  <span class="sail-id">VV_VSADDU</span>        &lt;-&gt; <span class="sail-literal">0b100000</span>,
  <span class="sail-id">VV_VSADD</span>         &lt;-&gt; <span class="sail-literal">0b100001</span>,
  <span class="sail-id">VV_VSSUBU</span>        &lt;-&gt; <span class="sail-literal">0b100010</span>,
  <span class="sail-id">VV_VSSUB</span>         &lt;-&gt; <span class="sail-literal">0b100011</span>,
  <span class="sail-id">VV_VSLL</span>          &lt;-&gt; <span class="sail-literal">0b100101</span>,
  <span class="sail-id">VV_VSMUL</span>         &lt;-&gt; <span class="sail-literal">0b100111</span>,
  <span class="sail-id">VV_VSRL</span>          &lt;-&gt; <span class="sail-literal">0b101000</span>,
  <span class="sail-id">VV_VSRA</span>          &lt;-&gt; <span class="sail-literal">0b101001</span>,
  <span class="sail-id">VV_VSSRL</span>         &lt;-&gt; <span class="sail-literal">0b101010</span>,
  <span class="sail-id">VV_VSSRA</span>         &lt;-&gt; <span class="sail-literal">0b101011</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">VVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_vvfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b000</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">VVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_pow</span>  = <a href=".././riscv_sys_regs.html#L997"><span class="sail-id">get_sew_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L99"><span class="sail-id">illegal_normal</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)     = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">VV_VADD</span>          =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">+</span> <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">VV_VSUB</span>          =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">-</span> <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">VV_VAND</span>          =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&amp;</span> <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">VV_VOR</span>           =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">|</span> <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">VV_VXOR</span>          =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">^</span> <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">VV_VSADDU</span>        =&gt; <a href=".././riscv_insts_vext_utils.html#L472"><span class="sail-id">unsigned_saturation</span></a>(<span class="sail-ty-var">'m</span>, <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">VV_VSADD</span>         =&gt; <a href=".././riscv_insts_vext_utils.html#L483"><span class="sail-id">signed_saturation</span></a>(<span class="sail-ty-var">'m</span>, <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">VV_VSSUBU</span>        =&gt; {
                              <span class="sail-keyword">if</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">&lt;</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]) <span class="sail-keyword">then</span> <a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>()
                              <span class="sail-keyword">else</span> <a href=".././riscv_insts_vext_utils.html#L472"><span class="sail-id">unsigned_saturation</span></a>(<span class="sail-ty-var">'m</span>, <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]))
                            },
        <span class="sail-id">VV_VSSUB</span>         =&gt; <a href=".././riscv_insts_vext_utils.html#L483"><span class="sail-id">signed_saturation</span></a>(<span class="sail-ty-var">'m</span>, <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">VV_VSMUL</span>         =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">result_mul</span> = <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]));
                              <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">result_mul</span>, <span class="sail-ty-var">'m</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">result_wide</span> = (<span class="sail-id">result_mul</span> <span class="sail-operator">&gt;&gt;</span> (<span class="sail-ty-var">'m</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>, <span class="sail-id">rounding_incr</span>);
                              <a href=".././riscv_insts_vext_utils.html#L483"><span class="sail-id">signed_saturation</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">result_wide</span>[<span class="sail-ty-var">'m</span>..<span class="sail-literal">0</span>])
                            },
        <span class="sail-id">VV_VSLL</span>          =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>], <span class="sail-id">SEW</span>);
                              <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&lt;&lt;</span> <span class="sail-id">shift_amount</span>
                            },
        <span class="sail-id">VV_VSRL</span>          =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>], <span class="sail-id">SEW</span>);
                              <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>
                            },
        <span class="sail-id">VV_VSRA</span>          =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>], <span class="sail-id">SEW</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                              <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>)
                            },
        <span class="sail-id">VV_VSSRL</span>         =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>], <span class="sail-id">SEW</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>], <span class="sail-id">shift_amount</span>);
                              (<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                            },
        <span class="sail-id">VV_VSSRA</span>         =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>], <span class="sail-id">SEW</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>], <span class="sail-id">shift_amount</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                              <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                            },
        <span class="sail-id">VV_VMINU</span>         =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">min</span>(<span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]))),
        <span class="sail-id">VV_VMIN</span>          =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">min</span>(<span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]))),
        <span class="sail-id">VV_VMAXU</span>         =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">max</span>(<span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]))),
        <span class="sail-id">VV_VMAX</span>          =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">max</span>(<span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]))),
        <span class="sail-id">VV_VRGATHER</span>      =&gt; {
                              <span class="sail-keyword">if</span> (<span class="sail-id">vs1</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span> <span class="sail-operator">|</span> <span class="sail-id">vs2</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();
                              <span class="sail-keyword">let</span> <span class="sail-id">idx</span> = <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]);
                              <span class="sail-keyword">let</span> <span class="sail-id">VLMAX</span> = 2 ^ (<span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-id">VLEN_pow</span> <span class="sail-operator">-</span> <span class="sail-id">SEW_pow</span>);
                              <span class="sail-keyword">assert</span>(<span class="sail-id">VLMAX</span> <span class="sail-operator">&lt;=</span> <span class="sail-ty-var">'n</span>);
                              <span class="sail-keyword">if</span> <span class="sail-id">idx</span> <span class="sail-operator">&lt;</span> <span class="sail-id">VLMAX</span> <span class="sail-keyword">then</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">idx</span>] <span class="sail-keyword">else</span> <a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>()
                            },
        <span class="sail-id">VV_VRGATHEREI16</span>  =&gt; {
                              <span class="sail-keyword">if</span> (<span class="sail-id">vs1</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span> <span class="sail-operator">|</span> <span class="sail-id">vs2</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();
                              <span class="sail-comment">/* vrgatherei16.vv uses SEW/LMUL for the data in vs2 but EEW=16 and EMUL = (16/SEW)*LMUL for the indices in vs1 */</span>
                              <span class="sail-keyword">let</span> <span class="sail-id">vs1_new</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-literal">16</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-literal">16</span>, <span class="sail-literal">4</span> <span class="sail-operator">+</span> <span class="sail-id">LMUL_pow</span> <span class="sail-operator">-</span> <span class="sail-id">SEW_pow</span>, <span class="sail-id">vs1</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">idx</span> = <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_new</span>[<span class="sail-id">i</span>]);
                              <span class="sail-keyword">let</span> <span class="sail-id">VLMAX</span> = 2 ^ (<span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-id">VLEN_pow</span> <span class="sail-operator">-</span> <span class="sail-id">SEW_pow</span>);
                              <span class="sail-keyword">assert</span>(<span class="sail-id">VLMAX</span> <span class="sail-operator">&lt;=</span> <span class="sail-ty-var">'n</span>);
                              <span class="sail-keyword">if</span> <span class="sail-id">idx</span> <span class="sail-operator">&lt;</span> <span class="sail-id">VLMAX</span> <span class="sail-keyword">then</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">idx</span>] <span class="sail-keyword">else</span> <a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>()
                            }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">vvtype_mnemonic</span> : <span class="sail-id">vvfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">VV_VADD</span>          &lt;-&gt; <span class="sail-string">"vadd.vv"</span>,
  <span class="sail-id">VV_VSUB</span>          &lt;-&gt; <span class="sail-string">"vsub.vv"</span>,
  <span class="sail-id">VV_VAND</span>          &lt;-&gt; <span class="sail-string">"vand.vv"</span>,
  <span class="sail-id">VV_VOR</span>           &lt;-&gt; <span class="sail-string">"vor.vv"</span>,
  <span class="sail-id">VV_VXOR</span>          &lt;-&gt; <span class="sail-string">"vxor.vv"</span>,
  <span class="sail-id">VV_VRGATHER</span>      &lt;-&gt; <span class="sail-string">"vrgather.vv"</span>,
  <span class="sail-id">VV_VRGATHEREI16</span>  &lt;-&gt; <span class="sail-string">"vrgatherei16.vv"</span>,
  <span class="sail-id">VV_VSADDU</span>        &lt;-&gt; <span class="sail-string">"vsaddu.vv"</span>,
  <span class="sail-id">VV_VSADD</span>         &lt;-&gt; <span class="sail-string">"vsadd.vv"</span>,
  <span class="sail-id">VV_VSSUBU</span>        &lt;-&gt; <span class="sail-string">"vssubu.vv"</span>,
  <span class="sail-id">VV_VSSUB</span>         &lt;-&gt; <span class="sail-string">"vssub.vv"</span>,
  <span class="sail-id">VV_VSLL</span>          &lt;-&gt; <span class="sail-string">"vsll.vv"</span>,
  <span class="sail-id">VV_VSMUL</span>         &lt;-&gt; <span class="sail-string">"vsmul.vv"</span>,
  <span class="sail-id">VV_VSRL</span>          &lt;-&gt; <span class="sail-string">"vsrl.vv"</span>,
  <span class="sail-id">VV_VSRA</span>          &lt;-&gt; <span class="sail-string">"vsra.vv"</span>,
  <span class="sail-id">VV_VSSRL</span>         &lt;-&gt; <span class="sail-string">"vssrl.vv"</span>,
  <span class="sail-id">VV_VSSRA</span>         &lt;-&gt; <span class="sail-string">"vssra.vv"</span>,
  <span class="sail-id">VV_VMINU</span>         &lt;-&gt; <span class="sail-string">"vminu.vv"</span>,
  <span class="sail-id">VV_VMIN</span>          &lt;-&gt; <span class="sail-string">"vmin.vv"</span>,
  <span class="sail-id">VV_VMAXU</span>         &lt;-&gt; <span class="sail-string">"vmaxu.vv"</span>,
  <span class="sail-id">VV_VMAX</span>          &lt;-&gt; <span class="sail-string">"vmax.vv"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">VVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">vvtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ************************** OPIVV (WVTYPE Narrowing) *************************** */</span>
<span class="sail-comment">/* ************** Vector Narrowing Integer Right Shift Instructions ************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">NVSTYPE</span> : (<span class="sail-id">nvsfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_nvsfunct6</span> : <span class="sail-id">nvsfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">NVS_VNSRL</span>       &lt;-&gt; <span class="sail-literal">0b101100</span>,
  <span class="sail-id">NVS_VNSRA</span>       &lt;-&gt; <span class="sail-literal">0b101101</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">NVSTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_nvsfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b000</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">NVSTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">LMUL_pow</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)     = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">NVS_VNSRL</span>  =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>], <span class="sail-id">SEW_widen</span>);
                        <span class="sail-id">slice</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>)
                      },
        <span class="sail-id">NVS_VNSRA</span>  =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>], <span class="sail-id">SEW_widen</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                        <span class="sail-keyword">let</span> <span class="sail-id">arith_shifted</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>) = <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW_widen</span>);
                        <span class="sail-id">slice</span>(<span class="sail-id">arith_shifted</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>)
                      }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">nvstype_mnemonic</span> : <span class="sail-id">nvsfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">NVS_VNSRL</span>       &lt;-&gt; <span class="sail-string">"vnsrl.wv"</span>,
  <span class="sail-id">NVS_VNSRA</span>       &lt;-&gt; <span class="sail-string">"vnsra.wv"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">NVSTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">nvstype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ************************** OPIVV (WVTYPE Narrowing) *************************** */</span>
<span class="sail-comment">/* *************** Vector Narrowing Fixed-Point Clip Instructions **************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">NVTYPE</span> : (<span class="sail-id">nvfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_nvfunct6</span> : <span class="sail-id">nvfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">NV_VNCLIPU</span>     &lt;-&gt; <span class="sail-literal">0b101110</span>,
  <span class="sail-id">NV_VNCLIP</span>      &lt;-&gt; <span class="sail-literal">0b101111</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">NVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_nvfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b000</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">NVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">LMUL_pow</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)     = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>], <span class="sail-id">SEW_widen</span>);
      <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>], <span class="sail-id">shift_amount</span>);
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">NV_VNCLIPU</span> =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">result_wide</span> = (<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'o</span>, <span class="sail-id">rounding_incr</span>);
                        <a href=".././riscv_insts_vext_utils.html#L472"><span class="sail-id">unsigned_saturation</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">result_wide</span>);
                      },
        <span class="sail-id">NV_VNCLIP</span>  =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">4</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                        <span class="sail-keyword">let</span> <span class="sail-id">result_wide</span> = <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'o</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'o</span>, <span class="sail-id">rounding_incr</span>);
                        <a href=".././riscv_insts_vext_utils.html#L483"><span class="sail-id">signed_saturation</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">result_wide</span>);
                      }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">nvtype_mnemonic</span> : <span class="sail-id">nvfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">NV_VNCLIPU</span>     &lt;-&gt; <span class="sail-string">"vnclipu.wv"</span>,
  <span class="sail-id">NV_VNCLIP</span>      &lt;-&gt; <span class="sail-string">"vnclip.wv"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">NVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">nvtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ********************** OPIVV (Integer Merge Instruction) ********************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MASKTYPEV</span> : (<span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MASKTYPEV</span> (<span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>,  <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-literal">0b010111</span> @ <span class="sail-literal">0b0</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b000</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MASKTYPEV</span>(<span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">start_element</span> : <span class="sail-id">nat</span> = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L220"><span class="sail-id">get_start_element</span></a>() {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">let</span> <span class="sail-id">end_element</span>   = <a href=".././riscv_insts_vext_utils.html#L236"><span class="sail-id">get_end_element</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>           = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span>      = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span>      = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>); <span class="sail-comment">/* max(VLMAX,VLEN/SEW)) */</span>
  <span class="sail-keyword">let</span> <span class="sail-id">real_num_elem</span> = <span class="sail-keyword">if</span> <span class="sail-id">LMUL_pow</span> <span class="sail-operator">&gt;=</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-id">num_elem</span> <span class="sail-keyword">else</span> <span class="sail-id">num_elem</span> <span class="sail-operator">/</span> (<span class="sail-literal">0</span> <span class="sail-operator">-</span> <span class="sail-id">LMUL_pow</span>); <span class="sail-comment">/* VLMAX */</span>

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L105"><span class="sail-id">illegal_vd_masked</span></a>(<span class="sail-id">vd</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)     = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-literal">0b0</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">var</span> <span class="sail-id">result</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <span class="sail-id">vector_init</span>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());

  <span class="sail-keyword">let</span> <span class="sail-id">tail_ag</span> : <span class="sail-id">agtype</span> = <a href=".././riscv_sys_regs.html#L1036"><span class="sail-id">get_vtype_vta</span></a>();
  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&lt;</span> <span class="sail-id">start_element</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]
    } <span class="sail-keyword">else</span> <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&gt;</span> <span class="sail-id">end_element</span> <span class="sail-operator">|</span> <span class="sail-id">i</span> <span class="sail-operator">&gt;=</span> <span class="sail-id">real_num_elem</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">tail_ag</span> {
        <span class="sail-id">UNDISTURBED</span> =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">AGNOSTIC</span>    =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>] <span class="sail-comment">/* TODO: configuration support */</span>
      }
    } <span class="sail-keyword">else</span> {
      <span class="sail-comment">/* the merge operates on all body elements */</span>
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">if</span> <span class="sail-id">vm_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>] <span class="sail-keyword">else</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MASKTYPEV</span>(<span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
&lt;-&gt; <span class="sail-string">"vmerge.vvm"</span> <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-string">"v0"</span>

<span class="sail-comment">/* ********************** OPIVV (Integer Move Instruction) *********************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MOVETYPEV</span> : (<span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MOVETYPEV</span> (<span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-literal">0b010111</span> @ <span class="sail-literal">0b1</span> @ <span class="sail-literal">0b00000</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b000</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MOVETYPEV</span>(<span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L116"><span class="sail-id">illegal_vd_unmasked</span></a>() <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)     = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-literal">0b1</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MOVETYPEV</span>(<span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-string">"vmv.v.v"</span> <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>)

<span class="sail-comment">/* ******************************* OPIVX (VXTYPE) ******************************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">VXTYPE</span> : (<span class="sail-id">vxfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_vxfunct6</span> : <span class="sail-id">vxfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">VX_VADD</span>       &lt;-&gt; <span class="sail-literal">0b000000</span>,
  <span class="sail-id">VX_VSUB</span>       &lt;-&gt; <span class="sail-literal">0b000010</span>,
  <span class="sail-id">VX_VRSUB</span>      &lt;-&gt; <span class="sail-literal">0b000011</span>,
  <span class="sail-id">VX_VMINU</span>      &lt;-&gt; <span class="sail-literal">0b000100</span>,
  <span class="sail-id">VX_VMIN</span>       &lt;-&gt; <span class="sail-literal">0b000101</span>,
  <span class="sail-id">VX_VMAXU</span>      &lt;-&gt; <span class="sail-literal">0b000110</span>,
  <span class="sail-id">VX_VMAX</span>       &lt;-&gt; <span class="sail-literal">0b000111</span>,
  <span class="sail-id">VX_VAND</span>       &lt;-&gt; <span class="sail-literal">0b001001</span>,
  <span class="sail-id">VX_VOR</span>        &lt;-&gt; <span class="sail-literal">0b001010</span>,
  <span class="sail-id">VX_VXOR</span>       &lt;-&gt; <span class="sail-literal">0b001011</span>,
  <span class="sail-id">VX_VSADDU</span>     &lt;-&gt; <span class="sail-literal">0b100000</span>,
  <span class="sail-id">VX_VSADD</span>      &lt;-&gt; <span class="sail-literal">0b100001</span>,
  <span class="sail-id">VX_VSSUBU</span>     &lt;-&gt; <span class="sail-literal">0b100010</span>,
  <span class="sail-id">VX_VSSUB</span>      &lt;-&gt; <span class="sail-literal">0b100011</span>,
  <span class="sail-id">VX_VSLL</span>       &lt;-&gt; <span class="sail-literal">0b100101</span>,
  <span class="sail-id">VX_VSMUL</span>      &lt;-&gt; <span class="sail-literal">0b100111</span>,
  <span class="sail-id">VX_VSRL</span>       &lt;-&gt; <span class="sail-literal">0b101000</span>,
  <span class="sail-id">VX_VSRA</span>       &lt;-&gt; <span class="sail-literal">0b101001</span>,
  <span class="sail-id">VX_VSSRL</span>      &lt;-&gt; <span class="sail-literal">0b101010</span>,
  <span class="sail-id">VX_VSSRA</span>      &lt;-&gt; <span class="sail-literal">0b101011</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">VXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_vxfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b100</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">VXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L99"><span class="sail-id">illegal_normal</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">VX_VADD</span>    =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">+</span> <span class="sail-id">rs1_val</span>,
        <span class="sail-id">VX_VSUB</span>    =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">-</span> <span class="sail-id">rs1_val</span>,
        <span class="sail-id">VX_VRSUB</span>   =&gt; <span class="sail-id">rs1_val</span> <span class="sail-operator">-</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">VX_VAND</span>    =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&amp;</span> <span class="sail-id">rs1_val</span>,
        <span class="sail-id">VX_VOR</span>     =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">|</span> <span class="sail-id">rs1_val</span>,
        <span class="sail-id">VX_VXOR</span>    =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">^</span> <span class="sail-id">rs1_val</span>,
        <span class="sail-id">VX_VSADDU</span>  =&gt; <a href=".././riscv_insts_vext_utils.html#L472"><span class="sail-id">unsigned_saturation</span></a>(<span class="sail-ty-var">'m</span>, <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">rs1_val</span>) ),
        <span class="sail-id">VX_VSADD</span>   =&gt; <a href=".././riscv_insts_vext_utils.html#L483"><span class="sail-id">signed_saturation</span></a>(<span class="sail-ty-var">'m</span>, <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">rs1_val</span>) ),
        <span class="sail-id">VX_VSSUBU</span>  =&gt; {
                        <span class="sail-keyword">if</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">&lt;</span> <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>) <span class="sail-keyword">then</span> <a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>()
                        <span class="sail-keyword">else</span> <a href=".././riscv_insts_vext_utils.html#L472"><span class="sail-id">unsigned_saturation</span></a>(<span class="sail-ty-var">'m</span>, <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">rs1_val</span>) )
                      },
        <span class="sail-id">VX_VSSUB</span>   =&gt; <a href=".././riscv_insts_vext_utils.html#L483"><span class="sail-id">signed_saturation</span></a>(<span class="sail-ty-var">'m</span>, <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">rs1_val</span>) ),
        <span class="sail-id">VX_VSMUL</span>   =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">result_mul</span> = <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>));
                        <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">result_mul</span>, <span class="sail-ty-var">'m</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">result_wide</span> = (<span class="sail-id">result_mul</span> <span class="sail-operator">&gt;&gt;</span> (<span class="sail-ty-var">'m</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>, <span class="sail-id">rounding_incr</span>);
                        <a href=".././riscv_insts_vext_utils.html#L483"><span class="sail-id">signed_saturation</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">result_wide</span>[<span class="sail-ty-var">'m</span>..<span class="sail-literal">0</span>])
                      },
        <span class="sail-id">VX_VSLL</span>    =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">rs1_val</span>, <span class="sail-id">SEW</span>);
                        <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&lt;&lt;</span> <span class="sail-id">shift_amount</span>
                      },
        <span class="sail-id">VX_VSRL</span>    =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">rs1_val</span>, <span class="sail-id">SEW</span>);
                        <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>
                      },
        <span class="sail-id">VX_VSRA</span>    =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">rs1_val</span>, <span class="sail-id">SEW</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                        <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>)
                      },
        <span class="sail-id">VX_VSSRL</span>   =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">rs1_val</span>, <span class="sail-id">SEW</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>], <span class="sail-id">shift_amount</span>);
                        (<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                      },
        <span class="sail-id">VX_VSSRA</span>   =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">rs1_val</span>, <span class="sail-id">SEW</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>], <span class="sail-id">shift_amount</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                        <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                      },
        <span class="sail-id">VX_VMINU</span>   =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">min</span>(<span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>))),
        <span class="sail-id">VX_VMIN</span>    =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">min</span>(<span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>))),
        <span class="sail-id">VX_VMAXU</span>   =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">max</span>(<span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>))),
        <span class="sail-id">VX_VMAX</span>    =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">max</span>(<span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>)))
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">vxtype_mnemonic</span> : <span class="sail-id">vxfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">VX_VADD</span>       &lt;-&gt; <span class="sail-string">"vadd.vx"</span>,
  <span class="sail-id">VX_VSUB</span>       &lt;-&gt; <span class="sail-string">"vsub.vx"</span>,
  <span class="sail-id">VX_VRSUB</span>      &lt;-&gt; <span class="sail-string">"vrsub.vx"</span>,
  <span class="sail-id">VX_VAND</span>       &lt;-&gt; <span class="sail-string">"vand.vx"</span>,
  <span class="sail-id">VX_VOR</span>        &lt;-&gt; <span class="sail-string">"vor.vx"</span>,
  <span class="sail-id">VX_VXOR</span>       &lt;-&gt; <span class="sail-string">"vxor.vx"</span>,
  <span class="sail-id">VX_VSADDU</span>     &lt;-&gt; <span class="sail-string">"vsaddu.vx"</span>,
  <span class="sail-id">VX_VSADD</span>      &lt;-&gt; <span class="sail-string">"vsadd.vx"</span>,
  <span class="sail-id">VX_VSSUBU</span>     &lt;-&gt; <span class="sail-string">"vssubu.vx"</span>,
  <span class="sail-id">VX_VSSUB</span>      &lt;-&gt; <span class="sail-string">"vssub.vx"</span>,
  <span class="sail-id">VX_VSLL</span>       &lt;-&gt; <span class="sail-string">"vsll.vx"</span>,
  <span class="sail-id">VX_VSMUL</span>      &lt;-&gt; <span class="sail-string">"vsmul.vx"</span>,
  <span class="sail-id">VX_VSRL</span>       &lt;-&gt; <span class="sail-string">"vsrl.vx"</span>,
  <span class="sail-id">VX_VSRA</span>       &lt;-&gt; <span class="sail-string">"vsra.vx"</span>,
  <span class="sail-id">VX_VSSRL</span>      &lt;-&gt; <span class="sail-string">"vssrl.vx"</span>,
  <span class="sail-id">VX_VSSRA</span>      &lt;-&gt; <span class="sail-string">"vssra.vx"</span>,
  <span class="sail-id">VX_VMINU</span>      &lt;-&gt; <span class="sail-string">"vminu.vx"</span>,
  <span class="sail-id">VX_VMIN</span>       &lt;-&gt; <span class="sail-string">"vmin.vx"</span>,
  <span class="sail-id">VX_VMAXU</span>      &lt;-&gt; <span class="sail-string">"vmaxu.vx"</span>,
  <span class="sail-id">VX_VMAX</span>       &lt;-&gt; <span class="sail-string">"vmax.vx"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">VXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">vxtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ************************** OPIVX (WXTYPE Narrowing) *************************** */</span>
<span class="sail-comment">/* ************** Vector Narrowing Integer Right Shift Instructions ************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">NXSTYPE</span> : (<span class="sail-id">nxsfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_nxsfunct6</span> : <span class="sail-id">nxsfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">NXS_VNSRL</span>       &lt;-&gt; <span class="sail-literal">0b101100</span>,
  <span class="sail-id">NXS_VNSRA</span>       &lt;-&gt; <span class="sail-literal">0b101101</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">NXSTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_nxsfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b100</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">NXSTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">LMUL_pow</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">NXS_VNSRL</span>  =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">rs1_val</span>, <span class="sail-id">SEW_widen</span>);
                        <span class="sail-id">slice</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>)
                      },
        <span class="sail-id">NXS_VNSRA</span>  =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">rs1_val</span>, <span class="sail-id">SEW_widen</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                        <span class="sail-keyword">let</span> <span class="sail-id">arith_shifted</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>) = <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW_widen</span>);
                        <span class="sail-id">slice</span>(<span class="sail-id">arith_shifted</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>)
                      }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">nxstype_mnemonic</span> : <span class="sail-id">nxsfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">NXS_VNSRL</span>       &lt;-&gt; <span class="sail-string">"vnsrl.wx"</span>,
  <span class="sail-id">NXS_VNSRA</span>       &lt;-&gt; <span class="sail-string">"vnsra.wx"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">NXSTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">nxstype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ************************** OPIVX (WXTYPE Narrowing) *************************** */</span>
<span class="sail-comment">/* *************** Vector Narrowing Fixed-Point Clip Instructions **************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">NXTYPE</span> : (<span class="sail-id">nxfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_nxfunct6</span> : <span class="sail-id">nxfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">NX_VNCLIPU</span>     &lt;-&gt; <span class="sail-literal">0b101110</span>,
  <span class="sail-id">NX_VNCLIP</span>      &lt;-&gt; <span class="sail-literal">0b101111</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">NXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_nxfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b100</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">NXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">LMUL_pow</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">rs1_val</span>, <span class="sail-id">SEW_widen</span>);
      <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>], <span class="sail-id">shift_amount</span>);
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">NX_VNCLIPU</span> =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">result_wide</span> = (<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'o</span>, <span class="sail-id">rounding_incr</span>);
                        <a href=".././riscv_insts_vext_utils.html#L472"><span class="sail-id">unsigned_saturation</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">result_wide</span>)
                      },
        <span class="sail-id">NX_VNCLIP</span>  =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">4</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                        <span class="sail-keyword">let</span> <span class="sail-id">result_wide</span> = <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'o</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'o</span>, <span class="sail-id">rounding_incr</span>);
                        <a href=".././riscv_insts_vext_utils.html#L483"><span class="sail-id">signed_saturation</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">result_wide</span>)
                      }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">nxtype_mnemonic</span> : <span class="sail-id">nxfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">NX_VNCLIPU</span>     &lt;-&gt; <span class="sail-string">"vnclipu.wx"</span>,
  <span class="sail-id">NX_VNCLIP</span>      &lt;-&gt; <span class="sail-string">"vnclip.wx"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">NXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">nxtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ***************** OPIVX (Vector Slide &amp; Gather Instructions) ****************** */</span>
<span class="sail-comment">/* Slide and gather instructions extend rs1/imm to XLEN instead of SEW bits */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">VXSG</span> : (<span class="sail-id">vxsgfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_vxsgfunct6</span> : <span class="sail-id">vxsgfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">VX_VSLIDEUP</span>     &lt;-&gt; <span class="sail-literal">0b001110</span>,
  <span class="sail-id">VX_VSLIDEDOWN</span>   &lt;-&gt; <span class="sail-literal">0b001111</span>,
  <span class="sail-id">VX_VRGATHER</span>     &lt;-&gt; <span class="sail-literal">0b001100</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">VXSG</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_vxsgfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b100</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">VXSG</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_pow</span>  = <a href=".././riscv_sys_regs.html#L997"><span class="sail-id">get_sew_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L99"><span class="sail-id">illegal_normal</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">nat</span>                  = <span class="sail-id">unsigned</span>(<span class="sail-id">X</span>(<span class="sail-id">rs1</span>));
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">VX_VSLIDEUP</span>    =&gt; {
                            <span class="sail-keyword">if</span> (<span class="sail-id">vs2</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();
                            <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&gt;=</span> <span class="sail-id">rs1_val</span> <span class="sail-keyword">then</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span> <span class="sail-operator">-</span> <span class="sail-id">rs1_val</span>] <span class="sail-keyword">else</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]
                          },
        <span class="sail-id">VX_VSLIDEDOWN</span>  =&gt; {
                            <span class="sail-keyword">let</span> <span class="sail-id">VLMAX</span> = 2 ^ (<span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-id">VLEN_pow</span> <span class="sail-operator">-</span> <span class="sail-id">SEW_pow</span>);
                            <span class="sail-keyword">assert</span>(<span class="sail-id">VLMAX</span> <span class="sail-operator">&gt;</span> <span class="sail-literal">0</span> <span class="sail-operator">&amp;</span> <span class="sail-id">VLMAX</span> <span class="sail-operator">&lt;=</span> <span class="sail-ty-var">'n</span>);
                            <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">+</span> <span class="sail-id">rs1_val</span> <span class="sail-operator">&lt;</span> <span class="sail-id">VLMAX</span> <span class="sail-keyword">then</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span> <span class="sail-operator">+</span> <span class="sail-id">rs1_val</span>] <span class="sail-keyword">else</span> <a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>()
                          },
        <span class="sail-id">VX_VRGATHER</span>    =&gt; {
                            <span class="sail-keyword">if</span> (<span class="sail-id">vs2</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();
                            <span class="sail-keyword">let</span> <span class="sail-id">VLMAX</span> = 2 ^ (<span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-id">VLEN_pow</span> <span class="sail-operator">-</span> <span class="sail-id">SEW_pow</span>);
                            <span class="sail-keyword">assert</span>(<span class="sail-id">VLMAX</span> <span class="sail-operator">&gt;</span> <span class="sail-literal">0</span> <span class="sail-operator">&amp;</span> <span class="sail-id">VLMAX</span> <span class="sail-operator">&lt;=</span> <span class="sail-ty-var">'n</span>);
                            <span class="sail-keyword">if</span> <span class="sail-id">rs1_val</span> <span class="sail-operator">&lt;</span> <span class="sail-id">VLMAX</span> <span class="sail-keyword">then</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">rs1_val</span>] <span class="sail-keyword">else</span> <a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>()
                          }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">vxsg_mnemonic</span> : <span class="sail-id">vxsgfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">VX_VSLIDEUP</span>     &lt;-&gt; <span class="sail-string">"vslideup.vx"</span>,
  <span class="sail-id">VX_VSLIDEDOWN</span>   &lt;-&gt; <span class="sail-string">"vslidedown.vx"</span>,
  <span class="sail-id">VX_VRGATHER</span>     &lt;-&gt; <span class="sail-string">"vrgather.vx"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">VXSG</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">vxsg_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ********************** OPIVX (Integer Merge Instruction) ********************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MASKTYPEX</span> : (<span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MASKTYPEX</span>(<span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-literal">0b010111</span> @ <span class="sail-literal">0b0</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b100</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MASKTYPEX</span>(<span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">start_element</span> : <span class="sail-id">nat</span> = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L220"><span class="sail-id">get_start_element</span></a>() {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">let</span> <span class="sail-id">end_element</span>   = <a href=".././riscv_insts_vext_utils.html#L236"><span class="sail-id">get_end_element</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>           = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span>      = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span>      = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>); <span class="sail-comment">/* max(VLMAX,VLEN/SEW)) */</span>
  <span class="sail-keyword">let</span> <span class="sail-id">real_num_elem</span> = <span class="sail-keyword">if</span> <span class="sail-id">LMUL_pow</span> <span class="sail-operator">&gt;=</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-id">num_elem</span> <span class="sail-keyword">else</span> <span class="sail-id">num_elem</span> <span class="sail-operator">/</span> (<span class="sail-literal">0</span> <span class="sail-operator">-</span> <span class="sail-id">LMUL_pow</span>); <span class="sail-comment">/* VLMAX */</span>

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L105"><span class="sail-id">illegal_vd_masked</span></a>(<span class="sail-id">vd</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-literal">0b0</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">var</span> <span class="sail-id">result</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <span class="sail-id">vector_init</span>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());

  <span class="sail-keyword">let</span> <span class="sail-id">tail_ag</span> : <span class="sail-id">agtype</span> = <a href=".././riscv_sys_regs.html#L1036"><span class="sail-id">get_vtype_vta</span></a>();
  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&lt;</span> <span class="sail-id">start_element</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]
    } <span class="sail-keyword">else</span> <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&gt;</span> <span class="sail-id">end_element</span> <span class="sail-operator">|</span> <span class="sail-id">i</span> <span class="sail-operator">&gt;=</span> <span class="sail-id">real_num_elem</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">tail_ag</span> {
        <span class="sail-id">UNDISTURBED</span> =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">AGNOSTIC</span>    =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>] <span class="sail-comment">/* TODO: configuration support */</span>
      }
    } <span class="sail-keyword">else</span> {
      <span class="sail-comment">/* the merge operates on all body elements */</span>
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">if</span> <span class="sail-id">vm_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> <span class="sail-id">rs1_val</span> <span class="sail-keyword">else</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MASKTYPEX</span>(<span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-string">"vmerge.vxm"</span> <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-string">"v0"</span>

<span class="sail-comment">/* ********************** OPIVX (Integer Move Instruction) *********************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MOVETYPEX</span> : (<span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MOVETYPEX</span> (<span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-literal">0b010111</span> @ <span class="sail-literal">0b1</span> @ <span class="sail-literal">0b00000</span> @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b100</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MOVETYPEX</span>(<span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L116"><span class="sail-id">illegal_vd_unmasked</span></a>() <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-ty-var">'m</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-literal">0b1</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-id">rs1_val</span>
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MOVETYPEX</span>(<span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-string">"vmv.v.x"</span> <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>)

<span class="sail-comment">/* ******************************* OPIVI (VITYPE) ******************************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">VITYPE</span> : (<span class="sail-id">vifunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">bits</span>(<span class="sail-literal">5</span>), <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_vifunct6</span> : <span class="sail-id">vifunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">VI_VADD</span>       &lt;-&gt; <span class="sail-literal">0b000000</span>,
  <span class="sail-id">VI_VRSUB</span>      &lt;-&gt; <span class="sail-literal">0b000011</span>,
  <span class="sail-id">VI_VAND</span>       &lt;-&gt; <span class="sail-literal">0b001001</span>,
  <span class="sail-id">VI_VOR</span>        &lt;-&gt; <span class="sail-literal">0b001010</span>,
  <span class="sail-id">VI_VXOR</span>       &lt;-&gt; <span class="sail-literal">0b001011</span>,
  <span class="sail-id">VI_VSADDU</span>     &lt;-&gt; <span class="sail-literal">0b100000</span>,
  <span class="sail-id">VI_VSADD</span>      &lt;-&gt; <span class="sail-literal">0b100001</span>,
  <span class="sail-id">VI_VSLL</span>       &lt;-&gt; <span class="sail-literal">0b100101</span>,
  <span class="sail-id">VI_VSRL</span>       &lt;-&gt; <span class="sail-literal">0b101000</span>,
  <span class="sail-id">VI_VSRA</span>       &lt;-&gt; <span class="sail-literal">0b101001</span>,
  <span class="sail-id">VI_VSSRL</span>      &lt;-&gt; <span class="sail-literal">0b101010</span>,
  <span class="sail-id">VI_VSSRA</span>      &lt;-&gt; <span class="sail-literal">0b101011</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">VITYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_vifunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">simm</span> @ <span class="sail-literal">0b011</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">VITYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L99"><span class="sail-id">illegal_normal</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">imm_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">simm</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">VI_VADD</span>    =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">+</span> <span class="sail-id">imm_val</span>,
        <span class="sail-id">VI_VRSUB</span>   =&gt; <span class="sail-id">imm_val</span> <span class="sail-operator">-</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">VI_VAND</span>    =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&amp;</span> <span class="sail-id">imm_val</span>,
        <span class="sail-id">VI_VOR</span>     =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">|</span> <span class="sail-id">imm_val</span>,
        <span class="sail-id">VI_VXOR</span>    =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">^</span> <span class="sail-id">imm_val</span>,
        <span class="sail-id">VI_VSADDU</span>  =&gt; <a href=".././riscv_insts_vext_utils.html#L472"><span class="sail-id">unsigned_saturation</span></a>(<span class="sail-ty-var">'m</span>, <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">imm_val</span>) ),
        <span class="sail-id">VI_VSADD</span>   =&gt; <a href=".././riscv_insts_vext_utils.html#L483"><span class="sail-id">signed_saturation</span></a>(<span class="sail-ty-var">'m</span>, <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">imm_val</span>) ),
        <span class="sail-id">VI_VSLL</span>    =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">simm</span>), <span class="sail-id">SEW</span>);
                        <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&lt;&lt;</span> <span class="sail-id">shift_amount</span>
                      },
        <span class="sail-id">VI_VSRL</span>    =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">simm</span>), <span class="sail-id">SEW</span>);
                        <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>
                      },
        <span class="sail-id">VI_VSRA</span>    =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">simm</span>), <span class="sail-id">SEW</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                        <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>)
                      },
        <span class="sail-id">VI_VSSRL</span>   =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">simm</span>), <span class="sail-id">SEW</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>], <span class="sail-id">shift_amount</span>);
                        (<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                      },
        <span class="sail-id">VI_VSSRA</span>   =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">simm</span>), <span class="sail-id">SEW</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>], <span class="sail-id">shift_amount</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                        <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                      }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">vitype_mnemonic</span> : <span class="sail-id">vifunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">VI_VADD</span>   &lt;-&gt; <span class="sail-string">"vadd.vi"</span>,
  <span class="sail-id">VI_VRSUB</span>  &lt;-&gt; <span class="sail-string">"vrsub.vi"</span>,
  <span class="sail-id">VI_VAND</span>   &lt;-&gt; <span class="sail-string">"vand.vi"</span>,
  <span class="sail-id">VI_VOR</span>    &lt;-&gt; <span class="sail-string">"vor.vi"</span>,
  <span class="sail-id">VI_VXOR</span>   &lt;-&gt; <span class="sail-string">"vxor.vi"</span>,
  <span class="sail-id">VI_VSADDU</span> &lt;-&gt; <span class="sail-string">"vsaddu.vi"</span>,
  <span class="sail-id">VI_VSADD</span>  &lt;-&gt; <span class="sail-string">"vsadd.vi"</span>,
  <span class="sail-id">VI_VSLL</span>   &lt;-&gt; <span class="sail-string">"vsll.vi"</span>,
  <span class="sail-id">VI_VSRL</span>   &lt;-&gt; <span class="sail-string">"vsrl.vi"</span>,
  <span class="sail-id">VI_VSRA</span>   &lt;-&gt; <span class="sail-string">"vsra.vi"</span>,
  <span class="sail-id">VI_VSSRL</span>  &lt;-&gt; <span class="sail-string">"vssrl.vi"</span>,
  <span class="sail-id">VI_VSSRA</span>  &lt;-&gt; <span class="sail-string">"vssra.vi"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">VITYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">vitype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">hex_bits_signed_5</span>(<span class="sail-id">simm</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ************************** OPIVI (WITYPE Narrowing) *************************** */</span>
<span class="sail-comment">/* ************** Vector Narrowing Integer Right Shift Instructions ************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">NISTYPE</span> : (<span class="sail-id">nisfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">bits</span>(<span class="sail-literal">5</span>), <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_nisfunct6</span> : <span class="sail-id">nisfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">NIS_VNSRL</span>       &lt;-&gt; <span class="sail-literal">0b101100</span>,
  <span class="sail-id">NIS_VNSRA</span>       &lt;-&gt; <span class="sail-literal">0b101101</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">NISTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_nisfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">simm</span> @ <span class="sail-literal">0b011</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">NISTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">LMUL_pow</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">imm_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">simm</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">NIS_VNSRL</span>  =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">imm_val</span>, <span class="sail-id">SEW_widen</span>);
                        <span class="sail-id">slice</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>)
                      },
        <span class="sail-id">NIS_VNSRA</span>  =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">imm_val</span>, <span class="sail-id">SEW_widen</span>);
                        <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                        <span class="sail-keyword">let</span> <span class="sail-id">arith_shifted</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>) = <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW_widen</span>);
                        <span class="sail-id">slice</span>(<span class="sail-id">arith_shifted</span>, <span class="sail-literal">0</span>, <span class="sail-id">SEW</span>)
                      }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">nistype_mnemonic</span> : <span class="sail-id">nisfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">NIS_VNSRL</span>       &lt;-&gt; <span class="sail-string">"vnsrl.wi"</span>,
  <span class="sail-id">NIS_VNSRA</span>       &lt;-&gt; <span class="sail-string">"vnsra.wi"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">NISTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">nistype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">hex_bits_signed_5</span>(<span class="sail-id">simm</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ************************** OPIVI (WITYPE Narrowing) *************************** */</span>
<span class="sail-comment">/* *************** Vector Narrowing Fixed-Point Clip Instructions **************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">NITYPE</span> : (<span class="sail-id">nifunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">bits</span>(<span class="sail-literal">5</span>), <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_nifunct6</span> : <span class="sail-id">nifunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">NI_VNCLIPU</span>     &lt;-&gt; <span class="sail-literal">0b101110</span>,
  <span class="sail-id">NI_VNCLIP</span>      &lt;-&gt; <span class="sail-literal">0b101111</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">NITYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_nifunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">simm</span> @ <span class="sail-literal">0b011</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">NITYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">LMUL_pow</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">imm_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">simm</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-keyword">let</span> <span class="sail-id">shift_amount</span> = <a href=".././riscv_insts_vext_utils.html#L447"><span class="sail-id">get_shift_amount</span></a>(<span class="sail-id">imm_val</span>, <span class="sail-id">SEW_widen</span>);
      <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>], <span class="sail-id">shift_amount</span>);
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">NI_VNCLIPU</span> =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">result_wide</span> = (<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'o</span>, <span class="sail-id">rounding_incr</span>);
                        <a href=".././riscv_insts_vext_utils.html#L472"><span class="sail-id">unsigned_saturation</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">result_wide</span>)
                      },
        <span class="sail-id">NI_VNCLIP</span>  =&gt; {
                        <span class="sail-keyword">let</span> <span class="sail-id">v_double</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span> <span class="sail-operator">*</span> <span class="sail-literal">4</span>) = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                        <span class="sail-keyword">let</span> <span class="sail-id">result_wide</span> = <span class="sail-id">slice</span>(<span class="sail-id">v_double</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-id">shift_amount</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'o</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'o</span>, <span class="sail-id">rounding_incr</span>);
                        <a href=".././riscv_insts_vext_utils.html#L483"><span class="sail-id">signed_saturation</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">result_wide</span>)
                      }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">nitype_mnemonic</span> : <span class="sail-id">nifunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">NI_VNCLIPU</span>     &lt;-&gt; <span class="sail-string">"vnclipu.wi"</span>,
  <span class="sail-id">NI_VNCLIP</span>      &lt;-&gt; <span class="sail-string">"vnclip.wi"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">NITYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">nitype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">hex_bits_signed_5</span>(<span class="sail-id">simm</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ***************** OPIVI (Vector Slide &amp; Gather Instructions) ****************** */</span>
<span class="sail-comment">/* Slide and gather instructions extend rs1/imm to XLEN instead of SEW bits */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">VISG</span> : (<span class="sail-id">visgfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">bits</span>(<span class="sail-literal">5</span>), <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_visgfunct6</span> : <span class="sail-id">visgfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">VI_VSLIDEUP</span>     &lt;-&gt; <span class="sail-literal">0b001110</span>,
  <span class="sail-id">VI_VSLIDEDOWN</span>   &lt;-&gt; <span class="sail-literal">0b001111</span>,
  <span class="sail-id">VI_VRGATHER</span>     &lt;-&gt; <span class="sail-literal">0b001100</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">VISG</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_visgfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">simm</span> @ <span class="sail-literal">0b011</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">VISG</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_pow</span>  = <a href=".././riscv_sys_regs.html#L997"><span class="sail-id">get_sew_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L99"><span class="sail-id">illegal_normal</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">imm_val</span> : <span class="sail-id">nat</span>                  = <span class="sail-id">unsigned</span>(<a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-id">xlen</span>, <span class="sail-id">simm</span>));
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">VI_VSLIDEUP</span>    =&gt; {
                            <span class="sail-keyword">if</span> (<span class="sail-id">vs2</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();
                            <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&gt;=</span> <span class="sail-id">imm_val</span> <span class="sail-keyword">then</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span> <span class="sail-operator">-</span> <span class="sail-id">imm_val</span>] <span class="sail-keyword">else</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]
                          },
        <span class="sail-id">VI_VSLIDEDOWN</span>  =&gt; {
                            <span class="sail-keyword">let</span> <span class="sail-id">VLMAX</span> = 2 ^ (<span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-id">VLEN_pow</span> <span class="sail-operator">-</span> <span class="sail-id">SEW_pow</span>);
                            <span class="sail-keyword">assert</span>(<span class="sail-id">VLMAX</span> <span class="sail-operator">&gt;</span> <span class="sail-literal">0</span> <span class="sail-operator">&amp;</span> <span class="sail-id">VLMAX</span> <span class="sail-operator">&lt;=</span> <span class="sail-ty-var">'n</span>);
                            <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">+</span> <span class="sail-id">imm_val</span> <span class="sail-operator">&lt;</span> <span class="sail-id">VLMAX</span> <span class="sail-keyword">then</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span> <span class="sail-operator">+</span> <span class="sail-id">imm_val</span>] <span class="sail-keyword">else</span> <a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>()
                          },
        <span class="sail-id">VI_VRGATHER</span>    =&gt; {
                            <span class="sail-keyword">if</span> (<span class="sail-id">vs2</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();
                            <span class="sail-keyword">let</span> <span class="sail-id">VLMAX</span> = 2 ^ (<span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-id">VLEN_pow</span> <span class="sail-operator">-</span> <span class="sail-id">SEW_pow</span>);
                            <span class="sail-keyword">assert</span>(<span class="sail-id">VLMAX</span> <span class="sail-operator">&gt;</span> <span class="sail-literal">0</span> <span class="sail-operator">&amp;</span> <span class="sail-id">VLMAX</span> <span class="sail-operator">&lt;=</span> <span class="sail-ty-var">'n</span>);
                            <span class="sail-keyword">if</span> <span class="sail-id">imm_val</span> <span class="sail-operator">&lt;</span> <span class="sail-id">VLMAX</span> <span class="sail-keyword">then</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">imm_val</span>] <span class="sail-keyword">else</span> <a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>()
                          }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">visg_mnemonic</span> : <span class="sail-id">visgfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">VI_VSLIDEUP</span>     &lt;-&gt; <span class="sail-string">"vslideup.vi"</span>,
  <span class="sail-id">VI_VSLIDEDOWN</span>   &lt;-&gt; <span class="sail-string">"vslidedown.vi"</span>,
  <span class="sail-id">VI_VRGATHER</span>     &lt;-&gt; <span class="sail-string">"vrgather.vi"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">VISG</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">visg_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">hex_bits_signed_5</span>(<span class="sail-id">simm</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ********************** OPIVI (Integer Merge Instruction) ********************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MASKTYPEI</span> : (<span class="sail-id">vregidx</span>, <span class="sail-id">bits</span>(<span class="sail-literal">5</span>), <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MASKTYPEI</span>(<span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-literal">0b010111</span> @ <span class="sail-literal">0b0</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">simm</span> @ <span class="sail-literal">0b011</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MASKTYPEI</span>(<span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">start_element</span> : <span class="sail-id">nat</span> = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L220"><span class="sail-id">get_start_element</span></a>() {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">let</span> <span class="sail-id">end_element</span>   = <a href=".././riscv_insts_vext_utils.html#L236"><span class="sail-id">get_end_element</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>           = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span>      = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span>      = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>); <span class="sail-comment">/* max(VLMAX,VLEN/SEW)) */</span>
  <span class="sail-keyword">let</span> <span class="sail-id">real_num_elem</span> = <span class="sail-keyword">if</span> <span class="sail-id">LMUL_pow</span> <span class="sail-operator">&gt;=</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-id">num_elem</span> <span class="sail-keyword">else</span> <span class="sail-id">num_elem</span> <span class="sail-operator">/</span> (<span class="sail-literal">0</span> <span class="sail-operator">-</span> <span class="sail-id">LMUL_pow</span>); <span class="sail-comment">/* VLMAX */</span>

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L105"><span class="sail-id">illegal_vd_masked</span></a>(<span class="sail-id">vd</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-literal">0b0</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">imm_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">simm</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">var</span> <span class="sail-id">result</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <span class="sail-id">vector_init</span>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());

  <span class="sail-keyword">let</span> <span class="sail-id">tail_ag</span> : <span class="sail-id">agtype</span> = <a href=".././riscv_sys_regs.html#L1036"><span class="sail-id">get_vtype_vta</span></a>();
  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&lt;</span> <span class="sail-id">start_element</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]
    } <span class="sail-keyword">else</span> <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&gt;</span> <span class="sail-id">end_element</span> <span class="sail-operator">|</span> <span class="sail-id">i</span> <span class="sail-operator">&gt;=</span> <span class="sail-id">real_num_elem</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">tail_ag</span> {
        <span class="sail-id">UNDISTURBED</span> =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">AGNOSTIC</span>    =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>] <span class="sail-comment">/* TODO: configuration support */</span>
      }
    } <span class="sail-keyword">else</span> {
      <span class="sail-comment">/* the merge operates on all body elements */</span>
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">if</span> <span class="sail-id">vm_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> <span class="sail-id">imm_val</span> <span class="sail-keyword">else</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MASKTYPEI</span>(<span class="sail-id">vs2</span>, <span class="sail-id">simm</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-string">"vmerge.vim"</span> <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">hex_bits_signed_5</span>(<span class="sail-id">simm</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-string">"v0"</span>

<span class="sail-comment">/* ********************** OPIVI (Integer Move Instruction) *********************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MOVETYPEI</span> : (<span class="sail-id">vregidx</span>, <span class="sail-id">bits</span>(<span class="sail-literal">5</span>))

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MOVETYPEI</span> (<span class="sail-id">vd</span>, <span class="sail-id">simm</span>)
  &lt;-&gt; <span class="sail-literal">0b010111</span> @ <span class="sail-literal">0b1</span> @ <span class="sail-literal">0b00000</span> @ <span class="sail-id">simm</span> @ <span class="sail-literal">0b011</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MOVETYPEI</span>(<span class="sail-id">vd</span>, <span class="sail-id">simm</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L116"><span class="sail-id">illegal_vd_unmasked</span></a>() <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-literal">0b1</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">imm_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">simm</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-id">imm_val</span>
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MOVETYPEI</span>(<span class="sail-id">vd</span>, <span class="sail-id">simm</span>)
  &lt;-&gt; <span class="sail-string">"vmv.v.i"</span> <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">hex_bits_signed_5</span>(<span class="sail-id">simm</span>)

<span class="sail-comment">/* ********************* OPIVI (Whole Vector Register Move) ********************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">VMVRTYPE</span> : (<span class="sail-id">vregidx</span>, {<span class="sail-literal">1</span>, <span class="sail-literal">2</span>, <span class="sail-literal">4</span>, <span class="sail-literal">8</span>}, <span class="sail-id">vregidx</span>)

<span class="sail-comment">// "The number of vector registers to copy is encoded in the low three
</span><span class="sail-comment">// bits of the simm field (simm[2:0]) using the same encoding as the nf[2:0]
</span><span class="sail-comment">// field for memory instructions, i.e., simm[2:0] = NREG-1.
</span><span class="sail-comment">//
</span><span class="sail-comment">// The value of NREG must be 1, 2, 4, or 8, and values of simm[4:0] other
</span><span class="sail-comment">// than 0, 1, 3, and 7 are reserved."
</span><span class="sail-keyword">mapping</span> <span class="sail-id">encdec_nreg</span> : <span class="sail-id">bits</span>(<span class="sail-literal">5</span>) &lt;-&gt; {<span class="sail-literal">1</span>, <span class="sail-literal">2</span>, <span class="sail-literal">4</span>, <span class="sail-literal">8</span>} = {
  <span class="sail-literal">0b00000</span> &lt;-&gt; <span class="sail-literal">1</span>,
  <span class="sail-literal">0b00001</span> &lt;-&gt; <span class="sail-literal">2</span>,
  <span class="sail-literal">0b00011</span> &lt;-&gt; <span class="sail-literal">4</span>,
  <span class="sail-literal">0b00111</span> &lt;-&gt; <span class="sail-literal">8</span>,
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">VMVRTYPE</span>(<span class="sail-id">vs2</span>, <span class="sail-id">nreg</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-literal">0b100111</span> @ <span class="sail-literal">0b1</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_nreg</span>(<span class="sail-id">nreg</span>) @ <span class="sail-literal">0b011</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">VMVRTYPE</span>(<span class="sail-id">vs2</span>, <span class="sail-id">nreg</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">start_element</span> : <span class="sail-id">nat</span> = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L220"><span class="sail-id">get_start_element</span></a>() {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>     = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">EMUL</span>    = <span class="sail-id">nreg</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">EMUL_pow</span> = <a href=".././prelude.html#L229"><span class="sail-id">log2</span></a>(<span class="sail-id">EMUL</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">EMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-literal">0b1</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">EMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">EMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">var</span> <span class="sail-id">result</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <span class="sail-id">vector_init</span>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&lt;</span> <span class="sail-id">start_element</span> <span class="sail-keyword">then</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>] <span class="sail-keyword">else</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">EMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-comment">// This is unfortunate. See https://github.com/rems-project/sail/issues/768
</span><span class="sail-keyword">mapping</span> <span class="sail-id">nreg_string</span> : {<span class="sail-literal">1</span>, <span class="sail-literal">2</span>, <span class="sail-literal">4</span>, <span class="sail-literal">8</span>} &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-literal">1</span> &lt;-&gt; <span class="sail-string">"1"</span>,
  <span class="sail-literal">2</span> &lt;-&gt; <span class="sail-string">"2"</span>,
  <span class="sail-literal">4</span> &lt;-&gt; <span class="sail-string">"4"</span>,
  <span class="sail-literal">8</span> &lt;-&gt; <span class="sail-string">"8"</span>,
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">VMVRTYPE</span>(<span class="sail-id">vs2</span>, <span class="sail-id">nreg</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-string">"vmv"</span> <span class="sail-operator">^</span> <span class="sail-id">nreg_string</span>(<span class="sail-id">nreg</span>) <span class="sail-operator">^</span> <span class="sail-string">"r.v"</span> <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>)

<span class="sail-comment">/* ******************************* OPMVV (VVTYPE) ******************************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MVVTYPE</span> : (<span class="sail-id">mvvfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_mvvfunct6</span> : <span class="sail-id">mvvfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">MVV_VAADDU</span>      &lt;-&gt; <span class="sail-literal">0b001000</span>,
  <span class="sail-id">MVV_VAADD</span>       &lt;-&gt; <span class="sail-literal">0b001001</span>,
  <span class="sail-id">MVV_VASUBU</span>      &lt;-&gt; <span class="sail-literal">0b001010</span>,
  <span class="sail-id">MVV_VASUB</span>       &lt;-&gt; <span class="sail-literal">0b001011</span>,
  <span class="sail-id">MVV_VMUL</span>        &lt;-&gt; <span class="sail-literal">0b100101</span>,
  <span class="sail-id">MVV_VMULH</span>       &lt;-&gt; <span class="sail-literal">0b100111</span>,
  <span class="sail-id">MVV_VMULHU</span>      &lt;-&gt; <span class="sail-literal">0b100100</span>,
  <span class="sail-id">MVV_VMULHSU</span>     &lt;-&gt; <span class="sail-literal">0b100110</span>,
  <span class="sail-id">MVV_VDIVU</span>       &lt;-&gt; <span class="sail-literal">0b100000</span>,
  <span class="sail-id">MVV_VDIV</span>        &lt;-&gt; <span class="sail-literal">0b100001</span>,
  <span class="sail-id">MVV_VREMU</span>       &lt;-&gt; <span class="sail-literal">0b100010</span>,
  <span class="sail-id">MVV_VREM</span>        &lt;-&gt; <span class="sail-literal">0b100011</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MVVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_mvvfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b010</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MVVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L99"><span class="sail-id">illegal_normal</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)     = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">MVV_VAADDU</span>   =&gt; {
                          <span class="sail-keyword">let</span> <span class="sail-id">result_add</span> = <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">result_add</span>, <span class="sail-literal">1</span>);
                          <span class="sail-id">slice</span>(<span class="sail-id">result_add</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-literal">1</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'m</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                        },
        <span class="sail-id">MVV_VAADD</span>    =&gt; {
                          <span class="sail-keyword">let</span> <span class="sail-id">result_add</span> = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">result_add</span>, <span class="sail-literal">1</span>);
                          <span class="sail-id">slice</span>(<span class="sail-id">result_add</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-literal">1</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'m</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                        },
        <span class="sail-id">MVV_VASUBU</span>   =&gt; {
                          <span class="sail-keyword">let</span> <span class="sail-id">result_sub</span> = <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">result_sub</span>, <span class="sail-literal">1</span>);
                          <span class="sail-id">slice</span>(<span class="sail-id">result_sub</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-literal">1</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'m</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                        },
        <span class="sail-id">MVV_VASUB</span>    =&gt; {
                          <span class="sail-keyword">let</span> <span class="sail-id">result_sub</span> = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">result_sub</span>, <span class="sail-literal">1</span>);
                          <span class="sail-id">slice</span>(<span class="sail-id">result_sub</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-literal">1</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'m</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                        },
        <span class="sail-id">MVV_VMUL</span>     =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]), <span class="sail-literal">0</span>),
        <span class="sail-id">MVV_VMULH</span>    =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">SEW</span>),
        <span class="sail-id">MVV_VMULHU</span>   =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">SEW</span>),
        <span class="sail-id">MVV_VMULHSU</span>  =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]), <span class="sail-id">SEW</span>),
        <span class="sail-id">MVV_VDIVU</span>    =&gt; {
                          <span class="sail-keyword">let</span> <span class="sail-id">divisor</span> = <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">dividend</span> = <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">q</span> : <span class="sail-id">int</span> = <span class="sail-keyword">if</span> <span class="sail-id">divisor</span> <span class="sail-operator">==</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-literal">-1</span> <span class="sail-keyword">else</span> <a href=".././prelude.html#L52"><span class="sail-id">quot_round_zero</span></a>(<span class="sail-id">dividend</span>, <span class="sail-id">divisor</span>);
                          <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">q</span>)
                        },
        <span class="sail-id">MVV_VDIV</span>     =&gt; {
                          <span class="sail-keyword">let</span> <span class="sail-id">elem_max</span> : <span class="sail-id">int</span> = 2 ^ (<span class="sail-id">SEW</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>) <span class="sail-operator">-</span> <span class="sail-literal">1</span>;
                          <span class="sail-keyword">let</span> <span class="sail-id">elem_min</span> : <span class="sail-id">int</span> = <span class="sail-literal">0</span> <span class="sail-operator">-</span> 2 ^ (<span class="sail-id">SEW</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>);
                          <span class="sail-keyword">let</span> <span class="sail-id">divisor</span> = <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">dividend</span> = <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">q</span> : <span class="sail-id">int</span> = <span class="sail-keyword">if</span> <span class="sail-id">divisor</span> <span class="sail-operator">==</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-literal">-1</span> <span class="sail-keyword">else</span> <a href=".././prelude.html#L52"><span class="sail-id">quot_round_zero</span></a>(<span class="sail-id">dividend</span>, <span class="sail-id">divisor</span>);
                          <span class="sail-comment">/* check for signed overflow */</span>
                          <span class="sail-keyword">let</span> <span class="sail-id">q'</span> : <span class="sail-id">int</span> = <span class="sail-keyword">if</span> <span class="sail-id">q</span> <span class="sail-operator">&gt;</span> <span class="sail-id">elem_max</span> <span class="sail-keyword">then</span> <span class="sail-id">elem_min</span> <span class="sail-keyword">else</span> <span class="sail-id">q</span>;
                          <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">q'</span>)
                        },
        <span class="sail-id">MVV_VREMU</span>    =&gt; {
                          <span class="sail-keyword">let</span> <span class="sail-id">divisor</span> = <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">dividend</span> = <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">r</span> : <span class="sail-id">int</span> = <span class="sail-keyword">if</span> <span class="sail-id">divisor</span> <span class="sail-operator">==</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-id">dividend</span> <span class="sail-keyword">else</span> <a href=".././prelude.html#L55"><span class="sail-id">rem_round_zero</span></a>(<span class="sail-id">dividend</span>, <span class="sail-id">divisor</span>);
                          <span class="sail-comment">/* signed overflow case returns zero naturally as required due to -1 divisor */</span>
                          <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">r</span>)
                        },
        <span class="sail-id">MVV_VREM</span>     =&gt; {
                          <span class="sail-keyword">let</span> <span class="sail-id">divisor</span> = <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">dividend</span> = <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                          <span class="sail-keyword">let</span> <span class="sail-id">r</span> : <span class="sail-id">int</span> = <span class="sail-keyword">if</span> <span class="sail-id">divisor</span> <span class="sail-operator">==</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-id">dividend</span> <span class="sail-keyword">else</span> <a href=".././prelude.html#L55"><span class="sail-id">rem_round_zero</span></a>(<span class="sail-id">dividend</span>, <span class="sail-id">divisor</span>);
                          <span class="sail-comment">/* signed overflow case returns zero naturally as required due to -1 divisor */</span>
                          <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">r</span>)
                        }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">mvvtype_mnemonic</span> : <span class="sail-id">mvvfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">MVV_VAADDU</span>   &lt;-&gt; <span class="sail-string">"vaaddu.vv"</span>,
  <span class="sail-id">MVV_VAADD</span>    &lt;-&gt; <span class="sail-string">"vaadd.vv"</span>,
  <span class="sail-id">MVV_VASUBU</span>   &lt;-&gt; <span class="sail-string">"vasubu.vv"</span>,
  <span class="sail-id">MVV_VASUB</span>    &lt;-&gt; <span class="sail-string">"vasub.vv"</span>,
  <span class="sail-id">MVV_VMUL</span>     &lt;-&gt; <span class="sail-string">"vmul.vv"</span>,
  <span class="sail-id">MVV_VMULH</span>    &lt;-&gt; <span class="sail-string">"vmulh.vv"</span>,
  <span class="sail-id">MVV_VMULHU</span>   &lt;-&gt; <span class="sail-string">"vmulhu.vv"</span>,
  <span class="sail-id">MVV_VMULHSU</span>  &lt;-&gt; <span class="sail-string">"vmulhsu.vv"</span>,
  <span class="sail-id">MVV_VDIVU</span>    &lt;-&gt; <span class="sail-string">"vdivu.vv"</span>,
  <span class="sail-id">MVV_VDIV</span>     &lt;-&gt; <span class="sail-string">"vdiv.vv"</span>,
  <span class="sail-id">MVV_VREMU</span>    &lt;-&gt; <span class="sail-string">"vremu.vv"</span>,
  <span class="sail-id">MVV_VREM</span>     &lt;-&gt; <span class="sail-string">"vrem.vv"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MVVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">mvvtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ************************* OPMVV (VVtype Multiply-Add) ************************* */</span>
<span class="sail-comment">/* Multiply-Add instructions switch the order of source operands in assembly (vs1/rs1 before vs2) */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MVVMATYPE</span> : (<span class="sail-id">mvvmafunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_mvvmafunct6</span> : <span class="sail-id">mvvmafunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">MVV_VMACC</span>       &lt;-&gt; <span class="sail-literal">0b101101</span>,
  <span class="sail-id">MVV_VNMSAC</span>      &lt;-&gt; <span class="sail-literal">0b101111</span>,
  <span class="sail-id">MVV_VMADD</span>       &lt;-&gt; <span class="sail-literal">0b101001</span>,
  <span class="sail-id">MVV_VNMSUB</span>      &lt;-&gt; <span class="sail-literal">0b101011</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MVVMATYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_mvvmafunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b010</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MVVMATYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L99"><span class="sail-id">illegal_normal</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">MVV_VMACC</span>  =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-literal">0</span>) <span class="sail-operator">+</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">MVV_VNMSAC</span> =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">-</span> <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-literal">0</span>),
        <span class="sail-id">MVV_VMADD</span>  =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]), <span class="sail-literal">0</span>) <span class="sail-operator">+</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">MVV_VNMSUB</span> =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">-</span> <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]), <span class="sail-literal">0</span>)
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">mvvmatype_mnemonic</span> : <span class="sail-id">mvvmafunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">MVV_VMACC</span>    &lt;-&gt; <span class="sail-string">"vmacc.vv"</span>,
  <span class="sail-id">MVV_VNMSAC</span>   &lt;-&gt; <span class="sail-string">"vnmsac.vv"</span>,
  <span class="sail-id">MVV_VMADD</span>    &lt;-&gt; <span class="sail-string">"vmadd.vv"</span>,
  <span class="sail-id">MVV_VNMSUB</span>   &lt;-&gt; <span class="sail-string">"vnmsub.vv"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MVVMATYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">mvvmatype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* *************************** OPMVV (VVTYPE Widening) *************************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">WVVTYPE</span> : (<span class="sail-id">wvvfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)
<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_wvvfunct6</span> : <span class="sail-id">wvvfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">WVV_VADD</span>       &lt;-&gt; <span class="sail-literal">0b110001</span>,
  <span class="sail-id">WVV_VSUB</span>       &lt;-&gt; <span class="sail-literal">0b110011</span>,
  <span class="sail-id">WVV_VADDU</span>      &lt;-&gt; <span class="sail-literal">0b110000</span>,
  <span class="sail-id">WVV_VSUBU</span>      &lt;-&gt; <span class="sail-literal">0b110010</span>,
  <span class="sail-id">WVV_VWMUL</span>      &lt;-&gt; <span class="sail-literal">0b111011</span>,
  <span class="sail-id">WVV_VWMULU</span>     &lt;-&gt; <span class="sail-literal">0b111000</span>,
  <span class="sail-id">WVV_VWMULSU</span>    &lt;-&gt; <span class="sail-literal">0b111010</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">WVVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_wvvfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b010</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">WVVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs1</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">LMUL_pow_widen</span>)) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">LMUL_pow_widen</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">WVV_VADD</span>    =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">WVV_VSUB</span>    =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">WVV_VADDU</span>   =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">WVV_VSUBU</span>   =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">WVV_VWMUL</span>   =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">WVV_VWMULU</span>  =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">WVV_VWMULSU</span> =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]))
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">wvvtype_mnemonic</span> : <span class="sail-id">wvvfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">WVV_VADD</span>       &lt;-&gt; <span class="sail-string">"vwadd.vv"</span>,
  <span class="sail-id">WVV_VSUB</span>       &lt;-&gt; <span class="sail-string">"vwsub.vv"</span>,
  <span class="sail-id">WVV_VADDU</span>      &lt;-&gt; <span class="sail-string">"vwaddu.vv"</span>,
  <span class="sail-id">WVV_VSUBU</span>      &lt;-&gt; <span class="sail-string">"vwsubu.vv"</span>,
  <span class="sail-id">WVV_VWMUL</span>      &lt;-&gt; <span class="sail-string">"vwmul.vv"</span>,
  <span class="sail-id">WVV_VWMULU</span>     &lt;-&gt; <span class="sail-string">"vwmulu.vv"</span>,
  <span class="sail-id">WVV_VWMULSU</span>    &lt;-&gt; <span class="sail-string">"vwmulsu.vv"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">WVVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">wvvtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* *************************** OPMVV (WVTYPE Widening) *************************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">WVTYPE</span> : (<span class="sail-id">wvfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_wvfunct6</span> : <span class="sail-id">wvfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">WV_VADD</span>       &lt;-&gt; <span class="sail-literal">0b110101</span>,
  <span class="sail-id">WV_VSUB</span>       &lt;-&gt; <span class="sail-literal">0b110111</span>,
  <span class="sail-id">WV_VADDU</span>      &lt;-&gt; <span class="sail-literal">0b110100</span>,
  <span class="sail-id">WV_VSUBU</span>      &lt;-&gt; <span class="sail-literal">0b110110</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">WVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_wvfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b010</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">WVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs1</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">LMUL_pow_widen</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">WV_VADD</span>  =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">WV_VSUB</span>  =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">WV_VADDU</span> =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>])),
        <span class="sail-id">WV_VSUBU</span> =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]))
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">wvtype_mnemonic</span> : <span class="sail-id">wvfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">WV_VADD</span>       &lt;-&gt; <span class="sail-string">"vwadd.wv"</span>,
  <span class="sail-id">WV_VSUB</span>       &lt;-&gt; <span class="sail-string">"vwsub.wv"</span>,
  <span class="sail-id">WV_VADDU</span>      &lt;-&gt; <span class="sail-string">"vwaddu.wv"</span>,
  <span class="sail-id">WV_VSUBU</span>      &lt;-&gt; <span class="sail-string">"vwsubu.wv"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">WVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">wvtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ******************** OPMVV (VVtype Widening Multiply-Add) ********************* */</span>
<span class="sail-comment">/* Multiply-Add instructions switch the order of source operands in assembly (vs1/rs1 before vs2) */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">WMVVTYPE</span> : (<span class="sail-id">wmvvfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_wmvvfunct6</span> : <span class="sail-id">wmvvfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">WMVV_VWMACCU</span>   &lt;-&gt; <span class="sail-literal">0b111100</span>,
  <span class="sail-id">WMVV_VWMACC</span>     &lt;-&gt; <span class="sail-literal">0b111101</span>,
  <span class="sail-id">WMVV_VWMACCSU</span>  &lt;-&gt; <span class="sail-literal">0b111111</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> =  <span class="sail-id">WMVVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_wmvvfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b010</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">WMVVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs1</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">LMUL_pow_widen</span>)) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">LMUL_pow_widen</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">WMVV_VWMACC</span>   =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>])) <span class="sail-operator">+</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">WMVV_VWMACCU</span>  =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>])) <span class="sail-operator">+</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">WMVV_VWMACCSU</span> =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]))<span class="sail-operator">+</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">wmvvtype_mnemonic</span> : <span class="sail-id">wmvvfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">WMVV_VWMACCU</span>     &lt;-&gt; <span class="sail-string">"vwmaccu.vv"</span>,
  <span class="sail-id">WMVV_VWMACC</span>      &lt;-&gt; <span class="sail-string">"vwmacc.vv"</span>,
  <span class="sail-id">WMVV_VWMACCSU</span>    &lt;-&gt; <span class="sail-string">"vwmaccsu.vv"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">WMVVTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">wmvvtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ****************************** OPMVV (VXUNARY0) ******************************* */</span>
<span class="sail-comment">/* ******************* Vector Integer Extension (SEW/2 source) ******************* */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">VEXTTYPE</span> : (<span class="sail-id">vextfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">vext_vs1</span> : <span class="sail-id">vextfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">5</span>) = {
  <span class="sail-id">VEXT2_ZVF2</span>  &lt;-&gt; <span class="sail-literal">0b00110</span>,
  <span class="sail-id">VEXT2_SVF2</span>  &lt;-&gt; <span class="sail-literal">0b00111</span>,
  <span class="sail-id">VEXT4_ZVF4</span>  &lt;-&gt; <span class="sail-literal">0b00100</span>,
  <span class="sail-id">VEXT4_SVF4</span>  &lt;-&gt; <span class="sail-literal">0b00101</span>,
  <span class="sail-id">VEXT8_ZVF8</span>  &lt;-&gt; <span class="sail-literal">0b00010</span>,
  <span class="sail-id">VEXT8_SVF8</span>  &lt;-&gt; <span class="sail-literal">0b00011</span>,
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">VEXTTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-literal">0b010010</span> @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">vext_vs1</span>(<span class="sail-id">funct6</span>) @ <span class="sail-literal">0b010</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">VEXTTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span> = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_frac_pow</span> : {<span class="sail-literal">1</span>, <span class="sail-literal">2</span>, <span class="sail-literal">3</span>} = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
    <span class="sail-id">VEXT2_ZVF2</span>  =&gt;  <span class="sail-literal">1</span>,
    <span class="sail-id">VEXT2_SVF2</span>  =&gt;  <span class="sail-literal">1</span>,
    <span class="sail-id">VEXT4_ZVF4</span>  =&gt;  <span class="sail-literal">2</span>,
    <span class="sail-id">VEXT4_SVF4</span>  =&gt;  <span class="sail-literal">2</span>,
    <span class="sail-id">VEXT8_ZVF8</span>  =&gt;  <span class="sail-literal">3</span>,
    <span class="sail-id">VEXT8_SVF8</span>  =&gt;  <span class="sail-literal">3</span>,
  };
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_div</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">-</span> <span class="sail-id">SEW_frac_pow</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_div</span> = <span class="sail-id">SEW</span> <span class="sail-operator">/</span> (2 ^ <span class="sail-id">SEW_frac_pow</span>);

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_div</span>, <span class="sail-id">LMUL_pow_div</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow_div</span>, <span class="sail-id">LMUL_pow</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_div</span> <span class="sail-operator">&gt;=</span> <span class="sail-literal">8</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_div</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_div</span>, <span class="sail-id">LMUL_pow_div</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">VEXT2_ZVF2</span> =&gt; <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]),
        <span class="sail-id">VEXT2_SVF2</span> =&gt; <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]),
        <span class="sail-id">VEXT4_ZVF4</span> =&gt; <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]),
        <span class="sail-id">VEXT4_SVF4</span> =&gt; <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]),
        <span class="sail-id">VEXT8_ZVF8</span> =&gt; <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]),
        <span class="sail-id">VEXT8_SVF8</span> =&gt; <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]),
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">vexttype_mnemonic</span> : <span class="sail-id">vextfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">VEXT2_ZVF2</span>  &lt;-&gt; <span class="sail-string">"vzext.vf2"</span>,
  <span class="sail-id">VEXT2_SVF2</span>  &lt;-&gt; <span class="sail-string">"vsext.vf2"</span>,
  <span class="sail-id">VEXT4_ZVF4</span>  &lt;-&gt; <span class="sail-string">"vzext.vf4"</span>,
  <span class="sail-id">VEXT4_SVF4</span>  &lt;-&gt; <span class="sail-string">"vsext.vf4"</span>,
  <span class="sail-id">VEXT8_ZVF8</span>  &lt;-&gt; <span class="sail-string">"vzext.vf8"</span>,
  <span class="sail-id">VEXT8_SVF8</span>  &lt;-&gt; <span class="sail-string">"vsext.vf8"</span>,
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">VEXTTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">vexttype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ************************ OPMVV (vmv.x.s in VWXUNARY0) ************************* */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">VMVXS</span> : (<span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">VMVXS</span>(<span class="sail-id">vs2</span>, <span class="sail-id">rd</span>)
  &lt;-&gt; <span class="sail-literal">0b010000</span> @ <span class="sail-literal">0b1</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-literal">0b00000</span> @ <span class="sail-literal">0b010</span> @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">VMVXS</span>(<span class="sail-id">vs2</span>, <span class="sail-id">rd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-literal">0</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L116"><span class="sail-id">illegal_vd_unmasked</span></a>() <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">num_elem</span> <span class="sail-operator">&gt;</span> <span class="sail-literal">0</span>);
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-literal">0</span>, <span class="sail-id">vs2</span>);
  <span class="sail-id">X</span>(<span class="sail-id">rd</span>) = <span class="sail-keyword">if</span> <span class="sail-id">xlen</span> <span class="sail-operator">&lt;</span> <span class="sail-id">SEW</span> <span class="sail-keyword">then</span> <span class="sail-id">slice</span>(<span class="sail-id">vs2_val</span>[<span class="sail-literal">0</span>], <span class="sail-literal">0</span>, <span class="sail-id">xlen</span>)
          <span class="sail-keyword">else</span> <span class="sail-keyword">if</span> <span class="sail-id">xlen</span> <span class="sail-operator">&gt;</span> <span class="sail-id">SEW</span> <span class="sail-keyword">then</span> <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-id">vs2_val</span>[<span class="sail-literal">0</span>])
          <span class="sail-keyword">else</span> <span class="sail-id">vs2_val</span>[<span class="sail-literal">0</span>];
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());

  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">VMVXS</span>(<span class="sail-id">vs2</span>, <span class="sail-id">rd</span>)
  &lt;-&gt; <span class="sail-string">"vmv.x.s"</span> <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>)

<span class="sail-comment">/* ********************* OPMVV (Vector Compress Instruction) ********************* */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MVVCOMPRESS</span> : (<span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MVVCOMPRESS</span>(<span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-literal">0b010111</span> @ <span class="sail-literal">0b1</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs1</span>) @ <span class="sail-literal">0b010</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MVVCOMPRESS</span>(<span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">start_element</span> : <span class="sail-id">nat</span> = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L220"><span class="sail-id">get_start_element</span></a>() {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">let</span> <span class="sail-id">end_element</span> = <a href=".././riscv_insts_vext_utils.html#L236"><span class="sail-id">get_end_element</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span> = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-comment">/* vcompress should always be executed with a vstart of 0 */</span>
  <span class="sail-keyword">if</span> <span class="sail-id">start_element</span> <span class="sail-operator">!=</span> <span class="sail-literal">0</span> <span class="sail-operator">|</span> <span class="sail-id">vs1</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span> <span class="sail-operator">|</span> <span class="sail-id">vs2</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span> <span class="sail-operator">|</span> <a href=".././riscv_insts_vext_utils.html#L116"><span class="sail-id">illegal_vd_unmasked</span></a>()
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-literal">0b0</span>, <span class="sail-id">vs1</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">var</span> <span class="sail-id">result</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <span class="sail-id">vector_init</span>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());

  <span class="sail-comment">/* body elements */</span>
  <span class="sail-keyword">var</span> <span class="sail-id">vd_idx</span> : <span class="sail-id">nat</span> = <span class="sail-literal">0</span>;
  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&lt;=</span> <span class="sail-id">end_element</span> <span class="sail-keyword">then</span> {
      <span class="sail-keyword">if</span> <span class="sail-id">vs1_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
        <span class="sail-keyword">let</span> <span class="sail-ty-var">'p</span> = <span class="sail-id">vd_idx</span>;
        <span class="sail-keyword">assert</span>(<span class="sail-ty-var">'p</span> <span class="sail-operator">&lt;</span> <span class="sail-ty-var">'n</span>);
        <span class="sail-id">result</span>[<span class="sail-ty-var">'p</span>] = <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>];
        <span class="sail-id">vd_idx</span> = <span class="sail-id">vd_idx</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;
      }
    }
  };
  <span class="sail-comment">/* tail elements */</span>
  <span class="sail-keyword">if</span> <span class="sail-id">vd_idx</span> <span class="sail-operator">&lt;</span> <span class="sail-id">num_elem</span> <span class="sail-keyword">then</span> {
    <span class="sail-keyword">let</span> <span class="sail-id">tail_ag</span> : <span class="sail-id">agtype</span> = <a href=".././riscv_sys_regs.html#L1036"><span class="sail-id">get_vtype_vta</span></a>();
    <span class="sail-keyword">let</span> <span class="sail-ty-var">'p</span> = <span class="sail-id">vd_idx</span>;
    <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-ty-var">'p</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">tail_ag</span> {
        <span class="sail-id">UNDISTURBED</span> =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">AGNOSTIC</span>    =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>] <span class="sail-comment">/* TODO: configuration support */</span>
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MVVCOMPRESS</span>(<span class="sail-id">vs2</span>, <span class="sail-id">vs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-string">"vcompress.vm"</span> <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs1</span>)

<span class="sail-comment">/* ******************************* OPMVX (VXTYPE) ******************************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MVXTYPE</span> : (<span class="sail-id">mvxfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_mvxfunct6</span> : <span class="sail-id">mvxfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">MVX_VAADDU</span>        &lt;-&gt; <span class="sail-literal">0b001000</span>,
  <span class="sail-id">MVX_VAADD</span>         &lt;-&gt; <span class="sail-literal">0b001001</span>,
  <span class="sail-id">MVX_VASUBU</span>        &lt;-&gt; <span class="sail-literal">0b001010</span>,
  <span class="sail-id">MVX_VASUB</span>         &lt;-&gt; <span class="sail-literal">0b001011</span>,
  <span class="sail-id">MVX_VSLIDE1UP</span>     &lt;-&gt; <span class="sail-literal">0b001110</span>,
  <span class="sail-id">MVX_VSLIDE1DOWN</span>   &lt;-&gt; <span class="sail-literal">0b001111</span>,
  <span class="sail-id">MVX_VMUL</span>          &lt;-&gt; <span class="sail-literal">0b100101</span>,
  <span class="sail-id">MVX_VMULH</span>         &lt;-&gt; <span class="sail-literal">0b100111</span>,
  <span class="sail-id">MVX_VMULHU</span>        &lt;-&gt; <span class="sail-literal">0b100100</span>,
  <span class="sail-id">MVX_VMULHSU</span>       &lt;-&gt; <span class="sail-literal">0b100110</span>,
  <span class="sail-id">MVX_VDIVU</span>         &lt;-&gt; <span class="sail-literal">0b100000</span>,
  <span class="sail-id">MVX_VDIV</span>          &lt;-&gt; <span class="sail-literal">0b100001</span>,
  <span class="sail-id">MVX_VREMU</span>         &lt;-&gt; <span class="sail-literal">0b100010</span>,
  <span class="sail-id">MVX_VREM</span>          &lt;-&gt; <span class="sail-literal">0b100011</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MVXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_mvxfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b110</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MVXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L99"><span class="sail-id">illegal_normal</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">MVX_VAADDU</span>       =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">result_add</span> = <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">rs1_val</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">result_add</span>, <span class="sail-literal">1</span>);
                              <span class="sail-id">slice</span>(<span class="sail-id">result_add</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-literal">1</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'m</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                            },
        <span class="sail-id">MVX_VAADD</span>        =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">result_add</span> = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">rs1_val</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">result_add</span>, <span class="sail-literal">1</span>);
                              <span class="sail-id">slice</span>(<span class="sail-id">result_add</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-literal">1</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'m</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                            },
        <span class="sail-id">MVX_VASUBU</span>       =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">result_sub</span> = <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">rs1_val</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">result_sub</span>, <span class="sail-literal">1</span>);
                              <span class="sail-id">slice</span>(<span class="sail-id">result_sub</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-literal">1</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'m</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                            },
        <span class="sail-id">MVX_VASUB</span>        =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">result_sub</span> = <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <a href=".././prelude.html#L85"><span class="sail-id">sign_extend</span></a>(<span class="sail-ty-var">'m</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>, <span class="sail-id">rs1_val</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">rounding_incr</span> = <a href=".././riscv_insts_vext_utils.html#L455"><span class="sail-id">get_fixed_rounding_incr</span></a>(<span class="sail-id">result_sub</span>, <span class="sail-literal">1</span>);
                              <span class="sail-id">slice</span>(<span class="sail-id">result_sub</span> <span class="sail-operator">&gt;&gt;</span> <span class="sail-literal">1</span>, <span class="sail-literal">0</span>, <span class="sail-ty-var">'m</span>) <span class="sail-operator">+</span> <a href=".././prelude.html#L86"><span class="sail-id">zero_extend</span></a>(<span class="sail-ty-var">'m</span>, <span class="sail-id">rounding_incr</span>)
                            },
        <span class="sail-id">MVX_VSLIDE1UP</span>    =&gt; {
                              <span class="sail-keyword">if</span> (<span class="sail-id">vs2</span> <span class="sail-operator">==</span> <span class="sail-id">vd</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();
                              <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">==</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-id">rs1_val</span> <span class="sail-keyword">else</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>]
                            },
        <span class="sail-id">MVX_VSLIDE1DOWN</span>  =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">last_elem</span> = <a href=".././riscv_insts_vext_utils.html#L236"><span class="sail-id">get_end_element</span></a>();
                              <span class="sail-keyword">assert</span>(<span class="sail-id">last_elem</span> <span class="sail-operator">&lt;</span> <span class="sail-id">num_elem</span>);
                              <span class="sail-keyword">if</span> <span class="sail-id">i</span> <span class="sail-operator">&lt;</span> <span class="sail-id">last_elem</span> <span class="sail-keyword">then</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>] <span class="sail-keyword">else</span> <span class="sail-id">rs1_val</span>
                            },
        <span class="sail-id">MVX_VMUL</span>         =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>), <span class="sail-literal">0</span>),
        <span class="sail-id">MVX_VMULH</span>        =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>), <span class="sail-id">SEW</span>),
        <span class="sail-id">MVX_VMULHU</span>       =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>), <span class="sail-id">SEW</span>),
        <span class="sail-id">MVX_VMULHSU</span>      =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>), <span class="sail-id">SEW</span>),
        <span class="sail-id">MVX_VDIVU</span>        =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">divisor</span> = <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">dividend</span> = <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                              <span class="sail-keyword">let</span> <span class="sail-id">q</span> : <span class="sail-id">int</span> = <span class="sail-keyword">if</span> <span class="sail-id">divisor</span> <span class="sail-operator">==</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-literal">-1</span> <span class="sail-keyword">else</span> <a href=".././prelude.html#L52"><span class="sail-id">quot_round_zero</span></a>(<span class="sail-id">dividend</span>, <span class="sail-id">divisor</span>);
                              <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">q</span>)
                            },
        <span class="sail-id">MVX_VDIV</span>         =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">elem_max</span> : <span class="sail-id">int</span> = 2 ^ (<span class="sail-id">SEW</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>) <span class="sail-operator">-</span> <span class="sail-literal">1</span>;
                              <span class="sail-keyword">let</span> <span class="sail-id">elem_min</span> : <span class="sail-id">int</span> = <span class="sail-literal">0</span> <span class="sail-operator">-</span> 2 ^ (<span class="sail-id">SEW</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">divisor</span> = <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">dividend</span> = <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                              <span class="sail-keyword">let</span> <span class="sail-id">q</span> : <span class="sail-id">int</span> = <span class="sail-keyword">if</span> <span class="sail-id">divisor</span> <span class="sail-operator">==</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-literal">-1</span> <span class="sail-keyword">else</span> <a href=".././prelude.html#L52"><span class="sail-id">quot_round_zero</span></a>(<span class="sail-id">dividend</span>, <span class="sail-id">divisor</span>);
                              <span class="sail-comment">/* check for signed overflow */</span>
                              <span class="sail-keyword">let</span> <span class="sail-id">q'</span> : <span class="sail-id">int</span> = <span class="sail-keyword">if</span> <span class="sail-id">q</span> <span class="sail-operator">&gt;</span> <span class="sail-id">elem_max</span> <span class="sail-keyword">then</span> <span class="sail-id">elem_min</span> <span class="sail-keyword">else</span> <span class="sail-id">q</span>;
                              <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">q'</span>)
                            },
        <span class="sail-id">MVX_VREMU</span>        =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">divisor</span> = <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">dividend</span> = <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                              <span class="sail-keyword">let</span> <span class="sail-id">r</span> : <span class="sail-id">int</span> = <span class="sail-keyword">if</span> <span class="sail-id">divisor</span> <span class="sail-operator">==</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-id">dividend</span> <span class="sail-keyword">else</span> <a href=".././prelude.html#L55"><span class="sail-id">rem_round_zero</span></a>(<span class="sail-id">dividend</span>, <span class="sail-id">divisor</span>);
                              <span class="sail-comment">/* signed overflow case returns zero naturally as required due to -1 divisor */</span>
                              <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">r</span>)
                            },
        <span class="sail-id">MVX_VREM</span>         =&gt; {
                              <span class="sail-keyword">let</span> <span class="sail-id">divisor</span> = <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>);
                              <span class="sail-keyword">let</span> <span class="sail-id">dividend</span> = <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]);
                              <span class="sail-keyword">let</span> <span class="sail-id">r</span> : <span class="sail-id">int</span> = <span class="sail-keyword">if</span> <span class="sail-id">divisor</span> <span class="sail-operator">==</span> <span class="sail-literal">0</span> <span class="sail-keyword">then</span> <span class="sail-id">dividend</span> <span class="sail-keyword">else</span> <a href=".././prelude.html#L55"><span class="sail-id">rem_round_zero</span></a>(<span class="sail-id">dividend</span>, <span class="sail-id">divisor</span>);
                              <span class="sail-comment">/* signed overflow case returns zero naturally as required due to -1 divisor */</span>
                              <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW</span>, <span class="sail-id">r</span>)
                            }
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">mvxtype_mnemonic</span> : <span class="sail-id">mvxfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">MVX_VAADDU</span>        &lt;-&gt; <span class="sail-string">"vaaddu.vx"</span>,
  <span class="sail-id">MVX_VAADD</span>         &lt;-&gt; <span class="sail-string">"vaadd.vx"</span>,
  <span class="sail-id">MVX_VASUBU</span>        &lt;-&gt; <span class="sail-string">"vasubu.vx"</span>,
  <span class="sail-id">MVX_VASUB</span>         &lt;-&gt; <span class="sail-string">"vasub.vx"</span>,
  <span class="sail-id">MVX_VSLIDE1UP</span>     &lt;-&gt; <span class="sail-string">"vslide1up.vx"</span>,
  <span class="sail-id">MVX_VSLIDE1DOWN</span>   &lt;-&gt; <span class="sail-string">"vslide1down.vx"</span>,
  <span class="sail-id">MVX_VMUL</span>          &lt;-&gt; <span class="sail-string">"vmul.vx"</span>,
  <span class="sail-id">MVX_VMULH</span>         &lt;-&gt; <span class="sail-string">"vmulh.vx"</span>,
  <span class="sail-id">MVX_VMULHU</span>        &lt;-&gt; <span class="sail-string">"vmulhu.vx"</span>,
  <span class="sail-id">MVX_VMULHSU</span>       &lt;-&gt; <span class="sail-string">"vmulhsu.vx"</span>,
  <span class="sail-id">MVX_VDIVU</span>         &lt;-&gt; <span class="sail-string">"vdivu.vx"</span>,
  <span class="sail-id">MVX_VDIV</span>          &lt;-&gt; <span class="sail-string">"vdiv.vx"</span>,
  <span class="sail-id">MVX_VREMU</span>         &lt;-&gt; <span class="sail-string">"vremu.vx"</span>,
  <span class="sail-id">MVX_VREM</span>          &lt;-&gt; <span class="sail-string">"vrem.vx"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MVXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">mvxtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ************************* OPMVX (VXtype Multiply-Add) ************************* */</span>
<span class="sail-comment">/* Multiply-Add instructions switch the order of source operands in assembly (vs1/rs1 before vs2) */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">MVXMATYPE</span> : (<span class="sail-id">mvxmafunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_mvxmafunct6</span> : <span class="sail-id">mvxmafunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">MVX_VMACC</span>         &lt;-&gt; <span class="sail-literal">0b101101</span>,
  <span class="sail-id">MVX_VNMSAC</span>        &lt;-&gt; <span class="sail-literal">0b101111</span>,
  <span class="sail-id">MVX_VMADD</span>         &lt;-&gt; <span class="sail-literal">0b101001</span>,
  <span class="sail-id">MVX_VNMSUB</span>        &lt;-&gt; <span class="sail-literal">0b101011</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">MVXMATYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_mvxmafunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b110</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">MVXMATYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L99"><span class="sail-id">illegal_normal</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>) <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">MVX_VMACC</span>  =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-literal">0</span>) <span class="sail-operator">+</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">MVX_VNMSAC</span> =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">-</span> <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]), <span class="sail-literal">0</span>),
        <span class="sail-id">MVX_VMADD</span>  =&gt; <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]), <span class="sail-literal">0</span>) <span class="sail-operator">+</span> <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">MVX_VNMSUB</span> =&gt; <span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>] <span class="sail-operator">-</span> <span class="sail-id">get_slice_int</span>(<span class="sail-id">SEW</span>, <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]), <span class="sail-literal">0</span>)
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">mvxmatype_mnemonic</span> : <span class="sail-id">mvxmafunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">MVX_VMACC</span>         &lt;-&gt; <span class="sail-string">"vmacc.vx"</span>,
  <span class="sail-id">MVX_VNMSAC</span>        &lt;-&gt; <span class="sail-string">"vnmsac.vx"</span>,
  <span class="sail-id">MVX_VMADD</span>         &lt;-&gt; <span class="sail-string">"vmadd.vx"</span>,
  <span class="sail-id">MVX_VNMSUB</span>        &lt;-&gt; <span class="sail-string">"vnmsub.vx"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">MVXMATYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">mvxmatype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* *************************** OPMVX (VXTYPE Widening) *************************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">WVXTYPE</span> : (<span class="sail-id">wvxfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_wvxfunct6</span> : <span class="sail-id">wvxfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">WVX_VADD</span>       &lt;-&gt; <span class="sail-literal">0b110001</span>,
  <span class="sail-id">WVX_VSUB</span>       &lt;-&gt; <span class="sail-literal">0b110011</span>,
  <span class="sail-id">WVX_VADDU</span>      &lt;-&gt; <span class="sail-literal">0b110000</span>,
  <span class="sail-id">WVX_VSUBU</span>      &lt;-&gt; <span class="sail-literal">0b110010</span>,
  <span class="sail-id">WVX_VWMUL</span>      &lt;-&gt; <span class="sail-literal">0b111011</span>,
  <span class="sail-id">WVX_VWMULU</span>     &lt;-&gt; <span class="sail-literal">0b111000</span>,
  <span class="sail-id">WVX_VWMULSU</span>    &lt;-&gt; <span class="sail-literal">0b111010</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">WVXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_wvxfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b110</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">WVXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">LMUL_pow_widen</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">WVX_VADD</span>    =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>)),
        <span class="sail-id">WVX_VSUB</span>    =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>)),
        <span class="sail-id">WVX_VADDU</span>   =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>)),
        <span class="sail-id">WVX_VSUBU</span>   =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>)),
        <span class="sail-id">WVX_VWMUL</span>   =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>)),
        <span class="sail-id">WVX_VWMULU</span>  =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>)),
        <span class="sail-id">WVX_VWMULSU</span> =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>))
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">wvxtype_mnemonic</span> : <span class="sail-id">wvxfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">WVX_VADD</span>       &lt;-&gt; <span class="sail-string">"vwadd.vx"</span>,
  <span class="sail-id">WVX_VSUB</span>       &lt;-&gt; <span class="sail-string">"vwsub.vx"</span>,
  <span class="sail-id">WVX_VADDU</span>      &lt;-&gt; <span class="sail-string">"vwaddu.vx"</span>,
  <span class="sail-id">WVX_VSUBU</span>      &lt;-&gt; <span class="sail-string">"vwsubu.vx"</span>,
  <span class="sail-id">WVX_VWMUL</span>      &lt;-&gt; <span class="sail-string">"vwmul.vx"</span>,
  <span class="sail-id">WVX_VWMULU</span>     &lt;-&gt; <span class="sail-string">"vwmulu.vx"</span>,
  <span class="sail-id">WVX_VWMULSU</span>    &lt;-&gt; <span class="sail-string">"vwmulsu.vx"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">WVXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">wvxtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* *************************** OPMVX (WXTYPE Widening) *************************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">WXTYPE</span> : (<span class="sail-id">wxfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_wxfunct6</span> : <span class="sail-id">wxfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">WX_VADD</span>       &lt;-&gt; <span class="sail-literal">0b110101</span>,
  <span class="sail-id">WX_VSUB</span>       &lt;-&gt; <span class="sail-literal">0b110111</span>,
  <span class="sail-id">WX_VADDU</span>      &lt;-&gt; <span class="sail-literal">0b110100</span>,
  <span class="sail-id">WX_VSUBU</span>      &lt;-&gt; <span class="sail-literal">0b110110</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">WXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_wxfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b110</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">WXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>)
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">WX_VADD</span>  =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>)),
        <span class="sail-id">WX_VSUB</span>  =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>)),
        <span class="sail-id">WX_VADDU</span> =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">+</span> <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>)),
        <span class="sail-id">WX_VSUBU</span> =&gt; <a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) <span class="sail-operator">-</span> <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>))
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">wxtype_mnemonic</span> : <span class="sail-id">wxfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">WX_VADD</span>       &lt;-&gt; <span class="sail-string">"vwadd.wx"</span>,
  <span class="sail-id">WX_VSUB</span>       &lt;-&gt; <span class="sail-string">"vwsub.wx"</span>,
  <span class="sail-id">WX_VADDU</span>      &lt;-&gt; <span class="sail-string">"vwaddu.wx"</span>,
  <span class="sail-id">WX_VSUBU</span>      &lt;-&gt; <span class="sail-string">"vwsubu.wx"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">WXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">wxtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ******************** OPMVX (VXtype Widening Multiply-Add) ********************* */</span>
<span class="sail-comment">/* Multiply-Add instructions switch the order of source operands in assembly (vs1/rs1 before vs2) */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> =  <span class="sail-id">WMVXTYPE</span> : (<span class="sail-id">wmvxfunct6</span>, <span class="sail-id">bits</span>(<span class="sail-literal">1</span>), <span class="sail-id">vregidx</span>, <span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-id">encdec_wmvxfunct6</span> : <span class="sail-id">wmvxfunct6</span> &lt;-&gt; <span class="sail-id">bits</span>(<span class="sail-literal">6</span>) = {
  <span class="sail-id">WMVX_VWMACCU</span>    &lt;-&gt; <span class="sail-literal">0b111100</span>,
  <span class="sail-id">WMVX_VWMACC</span>     &lt;-&gt; <span class="sail-literal">0b111101</span>,
  <span class="sail-id">WMVX_VWMACCUS</span>   &lt;-&gt; <span class="sail-literal">0b111110</span>,
  <span class="sail-id">WMVX_VWMACCSU</span>   &lt;-&gt; <span class="sail-literal">0b111111</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">WMVXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">encdec_wmvxfunct6</span>(<span class="sail-id">funct6</span>) @ <span class="sail-id">vm</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vs2</span>) @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b110</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">WMVXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow</span> = <a href=".././riscv_sys_regs.html#L1017"><span class="sail-id">get_lmul_pow</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-id">LMUL_pow</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">SEW_widen</span>      = <span class="sail-id">SEW</span> <span class="sail-operator">*</span> <span class="sail-literal">2</span>;
  <span class="sail-keyword">let</span> <span class="sail-id">LMUL_pow_widen</span> = <span class="sail-id">LMUL_pow</span> <span class="sail-operator">+</span> <span class="sail-literal">1</span>;

  <span class="sail-keyword">if</span>  <a href=".././riscv_insts_vext_utils.html#L125"><span class="sail-id">illegal_variable_width</span></a>(<span class="sail-id">vd</span>, <span class="sail-id">vm</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>) <span class="sail-operator">|</span>
      <a href=".././prelude.html#L29"><span class="sail-id">not</span></a>(<a href=".././riscv_insts_vext_utils.html#L70"><span class="sail-id">valid_reg_overlap</span></a>(<span class="sail-id">vs2</span>, <span class="sail-id">vd</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">LMUL_pow_widen</span>))
  <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">SEW_widen</span> <span class="sail-operator">&lt;=</span> <span class="sail-literal">64</span>);

  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'o</span> = <span class="sail-id">SEW_widen</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)     = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">vm</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-id">SEW</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vs2_val</span> : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-id">LMUL_pow</span>, <span class="sail-id">vs2</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'o</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">0</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-id">i</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> {
      <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">funct6</span> {
        <span class="sail-id">WMVX_VWMACCU</span>  =&gt; (<a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) )) <span class="sail-operator">+</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">WMVX_VWMACC</span>   =&gt; (<a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) )) <span class="sail-operator">+</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">WMVX_VWMACCUS</span> =&gt; (<a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">unsigned</span>(<span class="sail-id">rs1_val</span>) <span class="sail-operator">*</span> <span class="sail-id">signed</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) ))<span class="sail-operator">+</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
        <span class="sail-id">WMVX_VWMACCSU</span> =&gt; (<a href=".././prelude.html#L136"><span class="sail-id">to_bits_unsafe</span></a>(<span class="sail-id">SEW_widen</span>, <span class="sail-id">signed</span>(<span class="sail-id">rs1_val</span>) <span class="sail-operator">*</span> <span class="sail-id">unsigned</span>(<span class="sail-id">vs2_val</span>[<span class="sail-id">i</span>]) ))<span class="sail-operator">+</span> <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>]
      }
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW_widen</span>, <span class="sail-id">LMUL_pow_widen</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-id">wmvxtype_mnemonic</span> : <span class="sail-id">wmvxfunct6</span> &lt;-&gt; <span class="sail-id">string</span> = {
  <span class="sail-id">WMVX_VWMACCU</span>     &lt;-&gt; <span class="sail-string">"vwmaccu.vx"</span>,
  <span class="sail-id">WMVX_VWMACC</span>      &lt;-&gt; <span class="sail-string">"vwmacc.vx"</span>,
  <span class="sail-id">WMVX_VWMACCUS</span>    &lt;-&gt; <span class="sail-string">"vwmaccus.vx"</span>,
  <span class="sail-id">WMVX_VWMACCSU</span>    &lt;-&gt; <span class="sail-string">"vwmaccsu.vx"</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">WMVXTYPE</span>(<span class="sail-id">funct6</span>, <span class="sail-id">vm</span>, <span class="sail-id">vs2</span>, <span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-id">wmvxtype_mnemonic</span>(<span class="sail-id">funct6</span>) <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vs2</span>) <span class="sail-operator">^</span> <span class="sail-id">maybe_vmask</span>(<span class="sail-id">vm</span>)

<span class="sail-comment">/* ****************************** OPMVX (VRXUNARY0) ****************************** */</span>
<span class="sail-keyword">union</span> <span class="sail-keyword">clause</span> <span class="sail-id">instruction</span> = <span class="sail-id">VMVSX</span> : (<span class="sail-id">regidx</span>, <span class="sail-id">vregidx</span>)

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">encdec</span> = <span class="sail-id">VMVSX</span>(<span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-literal">0b010000</span> @ <span class="sail-literal">0b1</span> @ <span class="sail-literal">0b00000</span> @ <span class="sail-id">encdec_reg</span>(<span class="sail-id">rs1</span>) @ <span class="sail-literal">0b110</span> @ <span class="sail-id">encdec_vreg</span>(<span class="sail-id">vd</span>) @ <span class="sail-literal">0b1010111</span>
  <span class="sail-keyword">when</span> <a href=".././riscv_extensions.html#L31"><span class="sail-id">currentlyEnabled</span></a>(<span class="sail-id">Ext_V</span>)

<span class="sail-keyword">function</span> <span class="sail-keyword">clause</span> <span class="sail-id">execute</span>(<span class="sail-id">VMVSX</span>(<span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)) = {
  <span class="sail-keyword">let</span> <span class="sail-id">SEW</span>      = <a href=".././riscv_sys_regs.html#L1007"><span class="sail-id">get_sew</span></a>();
  <span class="sail-keyword">let</span> <span class="sail-id">num_elem</span> = <a href=".././riscv_vext_regs.html#L241"><span class="sail-id">get_num_elem</span></a>(<span class="sail-literal">0</span>, <span class="sail-id">SEW</span>);

  <span class="sail-keyword">if</span> <a href=".././riscv_insts_vext_utils.html#L116"><span class="sail-id">illegal_vd_unmasked</span></a>() <span class="sail-keyword">then</span> <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>();

  <span class="sail-keyword">assert</span>(<span class="sail-id">num_elem</span> <span class="sail-operator">&gt;</span> <span class="sail-literal">0</span>);
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'n</span> = <span class="sail-id">num_elem</span>;
  <span class="sail-keyword">let</span> <span class="sail-ty-var">'m</span> = <span class="sail-id">SEW</span>;

  <span class="sail-keyword">let</span> <span class="sail-id">vm_val</span>  : <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)             = <a href=".././riscv_vext_regs.html#L373"><span class="sail-id">read_vmask</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-literal">0b1</span>, <span class="sail-id">zvreg</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">rs1_val</span> : <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)             = <a href=".././riscv_insts_vext_utils.html#L173"><span class="sail-id">get_scalar</span></a>(<span class="sail-id">rs1</span>, <span class="sail-ty-var">'m</span>);
  <span class="sail-keyword">let</span> <span class="sail-id">vd_val</span>  : <span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)) = <a href=".././riscv_vext_regs.html#L279"><span class="sail-id">read_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-literal">0</span>, <span class="sail-id">vd</span>);

  <span class="sail-keyword">let</span> (<span class="sail-id">initial_result</span>, <span class="sail-id">mask</span>) : (<span class="sail-id">vector</span>(<span class="sail-ty-var">'n</span>, <span class="sail-id">bits</span>(<span class="sail-ty-var">'m</span>)), <span class="sail-id">bits</span>(<span class="sail-ty-var">'n</span>)) = <span class="sail-keyword">match</span> <a href=".././riscv_insts_vext_utils.html#L247"><span class="sail-id">init_masked_result</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-literal">0</span>, <span class="sail-id">vd_val</span>, <span class="sail-id">vm_val</span>) {
    <span class="sail-id">Ok</span>(<span class="sail-id">v</span>)   =&gt; <span class="sail-id">v</span>,
    <span class="sail-id">Err</span>(()) =&gt; <span class="sail-keyword">return</span> <span class="sail-id">Illegal_Instruction</span>()
  };
  <span class="sail-keyword">var</span> <span class="sail-id">result</span> = <span class="sail-id">initial_result</span>;

  <span class="sail-comment">/* one body element */</span>
  <span class="sail-keyword">if</span> <span class="sail-id">mask</span>[<span class="sail-literal">0</span>] <span class="sail-operator">==</span> <span class="sail-literal">bitone</span> <span class="sail-keyword">then</span> <span class="sail-id">result</span>[<span class="sail-literal">0</span>] = <span class="sail-id">rs1_val</span>;

  <span class="sail-comment">/* others treated as tail elements */</span>
  <span class="sail-keyword">let</span> <span class="sail-id">tail_ag</span> : <span class="sail-id">agtype</span> = <a href=".././riscv_sys_regs.html#L1036"><span class="sail-id">get_vtype_vta</span></a>();
  <span class="sail-keyword">foreach</span> (<span class="sail-id">i</span> <span class="sail-id">from</span> <span class="sail-literal">1</span> <span class="sail-id">to</span> (<span class="sail-id">num_elem</span> <span class="sail-operator">-</span> <span class="sail-literal">1</span>)) {
    <span class="sail-id">result</span>[<span class="sail-id">i</span>] = <span class="sail-keyword">match</span> <span class="sail-id">tail_ag</span> {
      <span class="sail-id">UNDISTURBED</span> =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>],
      <span class="sail-id">AGNOSTIC</span>    =&gt; <span class="sail-id">vd_val</span>[<span class="sail-id">i</span>] <span class="sail-comment">/* TODO: configuration support */</span>
    }
  };

  <a href=".././riscv_vext_regs.html#L330"><span class="sail-id">write_vreg</span></a>(<span class="sail-id">num_elem</span>, <span class="sail-id">SEW</span>, <span class="sail-literal">0</span>, <span class="sail-id">vd</span>, <span class="sail-id">result</span>);
  <a href=".././riscv_vext_control.html#L15"><span class="sail-id">set_vstart</span></a>(<a href=".././prelude.html#L89"><span class="sail-id">zeros</span></a>());
  <span class="sail-id">RETIRE_SUCCESS</span>
}

<span class="sail-keyword">mapping</span> <span class="sail-keyword">clause</span> <span class="sail-id">assembly</span> = <span class="sail-id">VMVSX</span>(<span class="sail-id">rs1</span>, <span class="sail-id">vd</span>)
  &lt;-&gt; <span class="sail-string">"vmv.s.x"</span> <span class="sail-operator">^</span> <span class="sail-id">spc</span>() <span class="sail-operator">^</span> <span class="sail-id">vreg_name</span>(<span class="sail-id">vd</span>) <span class="sail-operator">^</span> <span class="sail-id">sep</span>() <span class="sail-operator">^</span> <span class="sail-id">reg_name</span>(<span class="sail-id">rs1</span>)
</pre>
</div>
</div>
</body>
</html>